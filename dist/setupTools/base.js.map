{"version":3,"file":"base.js","names":["BasePlatformSetup","os","c","Config","getConfig","paths","globalConfigPath","workspace","config","availableDownloader","androidSdkLocation","replaceHomeFolder","sdksToInstall","logInfo","commandExistsSync","sdk","location","setupConfig","android","updateConfigFile","androidSdk","configureRnvGlobal","tizenSdk","tizenSdkPath","webosSdk","webosSdkPath","downloader","Error","logDebug","downloadLocation","shell","rm","aditionalArguments","locationArgument","command","sdkUrl","exec","skipPrereq","logTask","checkPrereqs","installPrereqs","downloadSdk","unzipSdk","installSdksAndEmulator","installTizenSdk","installWebosSdk","installFastlane","installDocker","postInstall","logError","program","ci","inquirer","prompt","name","type","message","response","sdkInstall","installSdk","includes"],"sources":["../../src/setupTools/base.js"],"sourcesContent":["/* eslint-disable import/no-cycle */\nimport shell from 'shelljs';\nimport inquirer from 'inquirer';\n\nimport { commandExistsSync } from '../systemTools/exec';\nimport { configureRnvGlobal } from '../configTools/configParser';\nimport { replaceHomeFolder, updateConfigFile } from '../systemTools/fileutils';\nimport setupConfig from './config';\nimport Config from '../config';\nimport { logTask, logError, logInfo, logDebug } from '../systemTools/logger';\n\nclass BasePlatformSetup {\n    constructor(os, c) {\n        // eslint-disable-next-line no-param-reassign\n        if (!c) c = Config.getConfig();\n        const { paths } = c;\n        this.os = os;\n        this.c = c;\n        this.globalConfigPath = paths.workspace.config;\n        this.availableDownloader = null;\n        this.androidSdkLocation = replaceHomeFolder('~/Android');\n        this.sdksToInstall = '\"build-tools;28.0.3\" \"emulator\" \"extras;android;m2repository\" \"extras;google;m2repository\" \"patcher;v4\" \"platform-tools\" \"platforms;android-28\" \"sources;android-28\" \"system-images;android-28;google_apis_playstore;x86\" \"tools\"';\n    }\n\n    checkPrereqs() {\n        logInfo(`Platform ${this.os}`);\n        logInfo('Checking if wget or curl is installed');\n        if (commandExistsSync('wget')) {\n            this.availableDownloader = 'wget';\n        } else if (commandExistsSync('curl')) {\n            this.availableDownloader = 'curl';\n        }\n    }\n\n    async installPrereqs() {\n        // to be overwritten\n        return true;\n    }\n\n    async postInstall(sdk) {\n        if (sdk === 'android') {\n            const { location } = setupConfig.android;\n            await updateConfigFile({ androidSdk: location }, this.globalConfigPath);\n            await configureRnvGlobal(this.c); // trigger the configure to update the paths for clis\n        }\n\n        if (sdk === 'tizen') {\n            await updateConfigFile({ tizenSdk: this.tizenSdkPath }, this.globalConfigPath);\n            await configureRnvGlobal(this.c); // trigger the configure to update the paths for clis\n        }\n\n        if (sdk === 'webos') {\n            await updateConfigFile({ webosSdk: this.webosSdkPath }, this.globalConfigPath);\n            await configureRnvGlobal(this.c); // trigger the configure to update the paths for clis\n        }\n    }\n\n    async downloadSdk(sdk) {\n        const downloader = this.availableDownloader;\n        if (!downloader) throw new Error('Wget or cURL not installed!');\n        logDebug(`Downloading ${sdk} SDK to ${setupConfig[sdk].downloadLocation} using ${downloader}`);\n        // remove the file if existing first\n        await shell.rm(setupConfig[sdk].downloadLocation);\n\n        let aditionalArguments;\n        let locationArgument;\n        if (downloader === 'wget') {\n            aditionalArguments = '-q';\n            locationArgument = replaceHomeFolder('-P ~/');\n        }\n        if (downloader === 'curl') {\n            aditionalArguments = '-#';\n            locationArgument = `--output ${setupConfig[sdk].downloadLocation}`;\n        }\n\n        const command = `${downloader} ${aditionalArguments} ${setupConfig[sdk].sdkUrl} ${locationArgument}`;\n\n        logDebug('Running', command);\n        logInfo(`Downloading ${sdk} SDK...`);\n        await shell.exec(command);\n    }\n\n    async unzipSdk(sdk) {\n        logDebug(`Unzipping from ${setupConfig[sdk].downloadLocation} to ${setupConfig[sdk].location}`);\n        if (!commandExistsSync('unzip')) throw new Error('unzip is not installed');\n        await shell.exec(`unzip -qq -o ${setupConfig[sdk].downloadLocation} -d ${setupConfig[sdk].location}`);\n    }\n\n    async installSdksAndEmulator() {\n        logDebug('Accepting licenses');\n        await shell.exec(`yes | ${setupConfig.android.location}/tools/bin/sdkmanager --licenses > /dev/null`);\n        logDebug('Installing SDKs', this.sdksToInstall);\n        await shell.exec(`${setupConfig.android.location}/tools/bin/sdkmanager ${this.sdksToInstall} > /dev/null`);\n    }\n\n    async installSdk(sdk, skipPrereq) {\n        logTask(`installSdk:${sdk}`);\n        !skipPrereq && this.checkPrereqs();\n        !skipPrereq && await this.installPrereqs();\n\n        switch (sdk) {\n            case 'android':\n                await this.downloadSdk(sdk);\n                await this.unzipSdk(sdk);\n                await this.installSdksAndEmulator();\n                break;\n            case 'tizen':\n                await this.installTizenSdk();\n                break;\n            case 'webos':\n                await this.installWebosSdk();\n                break;\n            case 'fastlane':\n                await this.installFastlane();\n                break;\n            case 'docker':\n                await this.installDocker();\n                break;\n            default:\n                break;\n        }\n\n        this.postInstall(sdk);\n    }\n\n    async installTizenSdk() {\n        // to be overwritten\n        logError('Install webos sdk not supported yet. Follow https://developer.tizen.org/development/tizen-studio/download to install it manually');\n        return true;\n    }\n\n    async installWebosSdk() {\n        // to be overwritten\n        logError('Install webos sdk not supported yet. Follow http://webostv.developer.lge.com/sdk/installation/ to install it manually');\n        return true;\n    }\n\n    async installFastlane() {\n        // to be overwritten\n        logError('Install fastlane not supported yet. Follow https://docs.fastlane.tools/getting-started/ios/setup/ to install it manually');\n        return true;\n    }\n\n    async installDocker() {\n        // to be overwritten\n        logError('Install docker not supported yet');\n        return true;\n    }\n\n    async askToInstallSDK(sdk) {\n        let sdkInstall;\n        if (!this.c.program.ci) {\n            const response = await inquirer.prompt([{\n                name: 'sdkInstall',\n                type: 'confirm',\n                message: `Do you want to install ${sdk} SDK?`,\n            }]);\n            // eslint-disable-next-line prefer-destructuring\n            sdkInstall = response.sdkInstall;\n        }\n\n        if (this.c.program.ci || sdkInstall) {\n            await this.installSdk(sdk, ['fastlane', 'docker'].includes(sdk)); // no prereqs needed for fastlane\n        } else {\n            throw new Error(`You can't run the project on this platform without ${sdk} sdk installed`);\n        }\n    }\n}\n\nexport default BasePlatformSetup;\n"],"mappings":"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"}