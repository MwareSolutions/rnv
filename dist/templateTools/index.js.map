{"version":3,"file":"index.js","names":["addTemplate","c","template","logTask","files","project","config","templates","version","_writeObjectSync","paths","checkIfTemplateInstalled","Promise","resolve","reject","buildConfig","logWarning","chalk","white","k","t","obj","startsWith","replace","templateFolder","path","join","nodeModulesDir","fs","existsSync","_requiresNpmInstall","package","devDependencies","applyTemplate","selectedTemplate","currentTemplate","runtime","opts","getInstalledTemplateOptions","inquirer","prompt","type","name","message","choices","keysAsArray","_applyTemplate","_configureSrc","_configureAppConfigs","_configureProjectConfig","_configureRenativeConfig","configureEntryPoints","_cleanProjectTemplateSync","dirsToRemove","projectConfig","dir","srcDir","appConfigsDir","filesToRemove","defaults","supportedPlatforms","map","p","removeDirsSync","removeFilesSync","isWrapper","configTemplate","RENATIVE_CONFIG_TEMPLATE_NAME","grey","projectConfigDir","Object","keys","requiresForcedTemplateApply","setAppConfig","appId","generateLocalConfig","logInfo","copyFolderContentsRecursiveSync","appConfigIds","listAppConfigsFoldersSync","forEach","v","appConfigPath","RENATIVE_CONFIG_NAME","appConfig","readObjectSync","common","title","id","supPlats","pk","platforms","includes","updateConfig","logError","templateConfig","isNew","mergedObj","mergeObjects","plugins","renative","getLocalRenativePlugin","configLocal","plat","source","entryFile","backupSource","rnv","projectTemplate","dest","copyFileSync","e","s","writeFileSync","generateBuildConfig","getTemplateOptions","generateOptions","projectTemplates","i","mapping","defaultVal","exists","installed","yellow","bold","rnvTemplateList","logToSummary","asString","rnvTemplateAdd","rnvTemplateApply","program"],"sources":["../../src/templateTools/index.js"],"sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs';\nimport path from 'path';\nimport inquirer from 'inquirer';\n\nimport { RENATIVE_CONFIG_NAME, RENATIVE_CONFIG_TEMPLATE_NAME } from '../constants';\nimport {\n    copyFolderContentsRecursiveSync,\n    copyFileSync, writeFileSync, removeDirsSync,\n    removeFilesSync, mergeObjects, readObjectSync\n} from '../systemTools/fileutils';\nimport { logToSummary, logError, logInfo, logWarning, logTask } from '../systemTools/logger';\nimport { getLocalRenativePlugin } from '../pluginTools';\nimport { generateOptions } from '../systemTools/prompt';\nimport { setAppConfig, listAppConfigsFoldersSync, generateBuildConfig, generateLocalConfig, updateConfig } from '../configTools/configParser';\n\n\n// let templateName = c.buildConfig.currentTemplate;\n// if (!templateName) {\n//     templateName = 'renative-template-hello-world';\n//     logWarning(`You're missing template name in your ${chalk.white(c.paths.project.config)}. ReNative will add default ${chalk.white(templateName)} for you`);\n//     c.buildConfig.defaults.template = templateName;\n//     fs.writeFileSync(c.paths.project.config, JSON.stringify(c.files.project.config, null, 2));\n// }\n\n\nexport const addTemplate = (c, template) => {\n    logTask('addTemplate');\n\n    c.files.project.config.templates = c.files.project.config.templates || {};\n\n    if (!c.files.project.config.templates[template]) {\n        c.files.project.config.templates[template] = {\n            version: 'latest'\n        };\n    }\n\n    _writeObjectSync(c, c.paths.project.config, c.files.project.config);\n};\n\nexport const checkIfTemplateInstalled = c => new Promise((resolve, reject) => {\n    logTask('checkIfTemplateInstalled');\n    if (!c.buildConfig.templates) {\n        logWarning(`Your ${chalk.white(c.paths.project.config)} does not contain ${chalk.white('templates')} object. ReNative will skip template generation`);\n        resolve();\n        return;\n    }\n\n    for (const k in c.buildConfig.templates) {\n        let t = k;\n        const obj = c.buildConfig.templates[k];\n        if (k.version && k.version.startsWith('file:')) {\n            t = `../${k.version.replace('file:', '')}`;\n        }\n        const templateFolder = path.join(c.paths.project.nodeModulesDir, k);\n        if (!fs.existsSync(templateFolder)) {\n            logWarning(`Your ${chalk.white(templateFolder)} template is not installed. ReNative will install it for you`);\n            // npmInstall(c).then(() => resolve()).catch(e => reject(e));\n            // return;\n            c._requiresNpmInstall = true;\n        }\n        if (c.files.project.package.devDependencies) {\n            c.files.project.package.devDependencies[k] = obj.version;\n        }\n    }\n    _writeObjectSync(c, c.paths.project.package, c.files.project.package);\n\n    resolve();\n});\n\nexport const applyTemplate = async (c, selectedTemplate) => {\n    logTask(`applyTemplate:${c.buildConfig.currentTemplate}=>${selectedTemplate}:`);\n    c.runtime.selectedTemplate = selectedTemplate;\n\n    if (!c.buildConfig.currentTemplate) {\n        logWarning('You don\\'t have any current template selected');\n        const opts = getInstalledTemplateOptions(c);\n\n        const { template } = await inquirer.prompt({\n            type: 'list',\n            name: 'template',\n            message: 'Pick which template to apply',\n            choices: opts.keysAsArray\n        });\n\n        c.buildConfig.currentTemplate = template;\n        c.files.project.config.currentTemplate = template;\n        _writeObjectSync(c, c.paths.project.config, c.files.project.config);\n    }\n\n    await _applyTemplate(c);\n    await _configureSrc(c);\n    await _configureAppConfigs(c);\n    await _configureProjectConfig(c);\n    await _configureRenativeConfig(c);\n    await configureEntryPoints(c);\n};\n\nconst _cleanProjectTemplateSync = (c) => {\n    logTask('_cleanProjectTemplateSync');\n    const dirsToRemove = [\n        path.join(c.paths.project.projectConfig.dir),\n        path.join(c.paths.project.srcDir),\n        path.join(c.paths.project.appConfigsDir)\n    ];\n\n    const filesToRemove = c.buildConfig.defaults.supportedPlatforms.map(p => path.join(c.paths.project.dir, `index.${p}.js`));\n\n    removeDirsSync(dirsToRemove);\n    // TODO: NOT SERVED FROM TEMPLATE YET\n    removeFilesSync(filesToRemove);\n};\n\nconst _applyTemplate = async (c) => {\n    logTask(`_applyTemplate:${c.runtime.selectedTemplate}`);\n\n    if (c.runtime.selectedTemplate) {\n        _cleanProjectTemplateSync(c);\n        if (c.runtime.isWrapper) {\n            c.paths.template.dir = path.join(c.paths.project.dir, 'packages', c.runtime.selectedTemplate);\n        } else {\n            c.paths.template.dir = path.join(c.paths.project.nodeModulesDir, c.runtime.selectedTemplate);\n        }\n    } else {\n        c.paths.template.dir = path.join(c.paths.project.nodeModulesDir, c.buildConfig.currentTemplate);\n    }\n\n    c.paths.template.configTemplate = path.join(c.paths.template.dir, RENATIVE_CONFIG_TEMPLATE_NAME);\n\n    if (!fs.existsSync(c.paths.template.configTemplate)) {\n        logWarning(`Template file ${chalk.white(c.paths.template.configTemplate)} does not exist. check your ${chalk.white(c.paths.template.dir)}. skipping`);\n        return true;\n    }\n\n    logTask(`_applyTemplate:${c.runtime.selectedTemplate}:${c.paths.template.dir}`, chalk.grey);\n\n    c.paths.template.appConfigsDir = path.join(c.paths.template.dir, 'appConfigs');\n    c.paths.template.projectConfigDir = path.join(c.paths.template.dir, 'projectConfig');\n    c.runtime.currentTemplate = c.files.project.config.currentTemplate;\n    if (!c.runtime.currentTemplate) {\n        c.runtime.currentTemplate = Object.keys(c.files.project.config.templates)[0];\n        c.runtime.requiresForcedTemplateApply = true;\n    }\n\n    await setAppConfig(c, c.runtime.appId);\n    generateLocalConfig(c, !!c.runtime.selectedTemplate);\n\n    return true;\n};\n\nconst _configureSrc = c => new Promise((resolve, reject) => {\n    // Check src\n    logTask('configureProject:check src', chalk.grey);\n    if (!fs.existsSync(c.paths.project.srcDir)) {\n        logInfo(`Looks like your src folder ${chalk.white(c.paths.project.srcDir)} is missing! Let's create one for you.`);\n        copyFolderContentsRecursiveSync(path.join(c.paths.template.dir, 'src'), c.paths.project.srcDir);\n    }\n    resolve();\n});\n\n\nconst _configureAppConfigs = async (c) => {\n    // Check appConfigs\n    logTask('configureProject:check appConfigs', chalk.grey);\n    //\n    if (!fs.existsSync(c.paths.project.appConfigsDir)) {\n        logInfo(\n            `Looks like your appConfig folder ${chalk.white(\n                c.paths.project.appConfigsDir,\n            )} is missing! ReNative will create one from template.`,\n        );\n\n        // TODO: GET CORRECT PROJECT TEMPLATE\n        copyFolderContentsRecursiveSync(c.paths.template.appConfigsDir, c.paths.project.appConfigsDir);\n\n        const appConfigIds = listAppConfigsFoldersSync(c, true);\n\n        // Update App Title to match package.json\n        try {\n            appConfigIds.forEach((v) => {\n                const appConfigPath = path.join(c.paths.project.appConfigsDir, v, RENATIVE_CONFIG_NAME);\n                const appConfig = readObjectSync(appConfigPath);\n                if (appConfig) {\n                    appConfig.common = appConfig.common || {};\n                    if (!c.runtime.isWrapper) {\n                        appConfig.common.title = c.files.project.config?.defaults?.title;\n                        appConfig.common.id = c.files.project.config?.defaults?.id;\n                    }\n\n                    _writeObjectSync(c, appConfigPath, appConfig);\n                }\n            });\n\n            const supPlats = c.files.project?.defaults?.supportedPlatforms;\n\n            if (supPlats) {\n                for (const pk in appConfig.platforms) {\n                    if (!supPlats.includes(pk)) {\n                        delete appConfig.platforms[pk];\n                    }\n                }\n            }\n            await updateConfig(c, true);\n        } catch (e) {\n            logError(e);\n        }\n    }\n};\n\nconst _configureProjectConfig = c => new Promise((resolve, reject) => {\n    // Check projectConfigs\n    logTask('configureProject:check projectConfigs', chalk.grey);\n    if (!fs.existsSync(c.paths.project.projectConfig.dir)) {\n        logInfo(\n            `Looks like your projectConfig folder ${chalk.white(c.paths.project.projectConfig.dir)} is missing! Let's create one for you.`,\n        );\n        copyFolderContentsRecursiveSync(c.paths.template.projectConfigDir, c.paths.project.projectConfig.dir);\n    }\n    resolve();\n});\n\nconst _configureRenativeConfig = c => new Promise((resolve, reject) => {\n    // renative.json\n    const templateConfig = readObjectSync(c.paths.template.configTemplate);\n    logTask('configureProject:check renative.json', chalk.grey);\n    if (!c.runtime.isWrapper) {\n        if (c.runtime.selectedTemplate || c.runtime.requiresForcedTemplateApply || c.files.project.config.isNew) {\n            logWarning(\n                `Looks like your ${c.paths.project.config} need to be updated with ${c.paths.template.configTemplate}`,\n            );\n            const mergedObj = mergeObjects(c, c.files.project.config, templateConfig, false, true);\n            mergedObj.currentTemplate = c.runtime.currentTemplate;\n            mergedObj.isNew = null;\n            delete mergedObj.isNew;\n            c.files.project.config = mergedObj;\n            _writeObjectSync(c, c.paths.project.config, mergedObj);\n        }\n    } else {\n        if (templateConfig.plugins.renative) {\n            templateConfig.plugins.renative = getLocalRenativePlugin();\n        }\n        _writeObjectSync(c, c.paths.project.configLocal, templateConfig);\n    }\n    resolve();\n});\n\nexport const configureEntryPoints = c => new Promise((resolve, reject) => {\n    logTask('configureEntryPoints');\n    // Check entry\n    // TODO: RN bundle command fails if entry files are not at root\n    // logTask('configureProject:check entry');\n    // if (!fs.existsSync(c.paths.entryDir)) {\n    //     logWarning(`Looks like your entry folder ${chalk.white(c.paths.entryDir)} is missing! Let's create one for you.`);\n    //     copyFolderContentsRecursiveSync(path.join(c.paths.rnv.dir, 'entry'), c.paths.entryDir);\n    // }\n\n    try {\n        if (!fs.existsSync(c.paths.appConfig.config)) {\n            logWarning(`ERROR: c.paths.appConfig.config: ${c.paths.appConfig.config} does not exist`);\n            resolve();\n            return;\n        }\n        let plat;\n        const p = c.buildConfig.platforms;\n        const supportedPlatforms = c.buildConfig.defaults?.supportedPlatforms;\n        for (const k in p) {\n            if (supportedPlatforms && supportedPlatforms.includes(k) || !supportedPlatforms) {\n                plat = p[k];\n                const source = path.join(c.paths.template.dir, `${plat.entryFile}.js`);\n                const backupSource = path.join(c.paths.rnv.projectTemplate.dir, 'entry', `${plat.entryFile}.js`);\n                const dest = path.join(c.paths.project.dir, `${plat.entryFile}.js`);\n                if (!fs.existsSync(dest)) {\n                    if (!plat.entryFile) {\n                        logWarning(`You missing entryFile for ${chalk.white(k)} platform in your ${chalk.white(c.paths.appConfig.config)}.`);\n                    } else if (!fs.existsSync(source)) {\n                        logInfo(`You missing entry file ${chalk.white(source)} in your template. ReNative Will use default backup entry from ${chalk.white(backupSource)}!`);\n                        copyFileSync(backupSource, dest);\n                    } else {\n                        logInfo(`You missing entry file ${chalk.white(plat.entryFile)} in your project. let's create one for you!`);\n                        copyFileSync(source, dest);\n                    }\n                }\n            } else {\n                logWarning(`Extra platform ${chalk.white(k)} will be ignored because it's not configured in your ${chalk.white('./renative.json: { defaults.supportedPlatforms }')} object.`);\n            }\n        }\n    } catch (e) {\n        reject();\n        return;\n    }\n\n    resolve();\n});\n\nconst _writeObjectSync = (c, p, s) => {\n    writeFileSync(p, s);\n    generateBuildConfig(c);\n};\n\nexport const getTemplateOptions = c => generateOptions(c.buildConfig.projectTemplates, false, null, (i, obj, mapping, defaultVal) => {\n    const exists = c.buildConfig.templates?.[defaultVal];\n    const installed = exists ? chalk.yellow(' (installed)') : '';\n    return ` [${chalk.grey(i + 1)}]> ${chalk.bold(defaultVal)}${installed} \\n`;\n});\n\nexport const getInstalledTemplateOptions = (c) => {\n    if (c.buildConfig.templates) {\n        return generateOptions(c.buildConfig.templates);\n    }\n    logError('You don\\'t have any local templates installed', false, true);\n    return [];\n};\n\n\nexport const rnvTemplateList = c => new Promise((resolve, reject) => {\n    logTask('rnvTemplateList');\n    const opts = getTemplateOptions(c);\n    logToSummary(`Templates:\\n\\n${opts.asString}`);\n    resolve();\n});\n\nexport const rnvTemplateAdd = async (c) => {\n    logTask('rnvTemplateAdd');\n\n    const opts = getTemplateOptions(c);\n\n    const { template } = await inquirer.prompt({\n        type: 'list',\n        message: 'Pick which template to install',\n        name: 'template',\n        choices: opts.keysAsArray\n    });\n\n    addTemplate(c, template);\n};\n\nexport const rnvTemplateApply = async (c) => {\n    logTask(`rnvTemplateApply:${c.program.template}`);\n\n    if (c.program.template) {\n        return applyTemplate(c, c.program.template);\n    }\n    const opts = getInstalledTemplateOptions(c);\n\n    const { template } = await inquirer.prompt({\n        type: 'list',\n        message: 'Pick which template to install',\n        name: 'template',\n        choices: opts.keysAsArray\n    });\n\n    applyTemplate(c, template);\n};\n"],"mappings":"idAAA;AACA;AACA;AACA;;AAEA;AACA;;;;;AAKA;AACA;AACA;AACA;;;;;;;;;;;;AAYO,GAAMA,YAAW,CAAG,QAAdA,YAAW,CAAIC,CAAC,CAAEC,QAAQ,CAAK;AACxC,GAAAC,eAAO,EAAC,aAAa,CAAC;;AAEtBF,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAACC,SAAS,CAAGN,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAACC,SAAS,EAAI,CAAC,CAAC;;AAEzE,GAAI,CAACN,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAACC,SAAS,CAACL,QAAQ,CAAC,CAAE;AAC7CD,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAACC,SAAS,CAACL,QAAQ,CAAC,CAAG;AACzCM,OAAO,CAAE;AACb,CAAC;AACL;;AAEAC,gBAAgB,CAACR,CAAC,CAAEA,CAAC,CAACS,KAAK,CAACL,OAAO,CAACC,MAAM,CAAEL,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAC;AACvE,CAAC,CAAC;;AAEK,GAAMK,yBAAwB,CAAG,QAA3BA,yBAAwB,CAAGV,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;AAC1E,GAAAX,eAAO,EAAC,0BAA0B,CAAC;AACnC,GAAI,CAACF,CAAC,CAACc,WAAW,CAACR,SAAS,CAAE;AAC1B,GAAAS,kBAAU,UAASC,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACC,MAAM,CAAC,sBAAqBW,cAAK,CAACC,KAAK,CAAC,WAAW,CAAC,mDAAkD;AACrJL,OAAO,EAAE;AACT;AACJ;;AAEA,IAAK,GAAMM,EAAC,GAAIlB,EAAC,CAACc,WAAW,CAACR,SAAS,CAAE;AACrC,GAAIa,EAAC,CAAGD,CAAC;AACT,GAAME,IAAG,CAAGpB,CAAC,CAACc,WAAW,CAACR,SAAS,CAACY,CAAC,CAAC;AACtC,GAAIA,CAAC,CAACX,OAAO,EAAIW,CAAC,CAACX,OAAO,CAACc,UAAU,CAAC,OAAO,CAAC,CAAE;AAC5CF,CAAC,OAASD,CAAC,CAACX,OAAO,CAACe,OAAO,CAAC,OAAO,CAAE,EAAE,CAAG;AAC9C;AACA,GAAMC,eAAc,CAAGC,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACsB,cAAc,CAAER,CAAC,CAAC;AACnE,GAAI,CAACS,WAAE,CAACC,UAAU,CAACL,cAAc,CAAC,CAAE;AAChC,GAAAR,kBAAU,UAASC,cAAK,CAACC,KAAK,CAACM,cAAc,CAAC,gEAA+D;;;AAG7GvB,CAAC,CAAC6B,mBAAmB,CAAG,IAAI;AAChC;AACA,GAAI7B,CAAC,CAACG,KAAK,CAACC,OAAO,CAAC0B,OAAO,CAACC,eAAe,CAAE;AACzC/B,CAAC,CAACG,KAAK,CAACC,OAAO,CAAC0B,OAAO,CAACC,eAAe,CAACb,CAAC,CAAC,CAAGE,GAAG,CAACb,OAAO;AAC5D;AACJ;AACAC,gBAAgB,CAACR,CAAC,CAAEA,CAAC,CAACS,KAAK,CAACL,OAAO,CAAC0B,OAAO,CAAE9B,CAAC,CAACG,KAAK,CAACC,OAAO,CAAC0B,OAAO,CAAC;;AAErElB,OAAO,EAAE;AACb,CAAC,CAAC,GAAC;;AAEI,GAAMoB,cAAa,CAAG,QAAhBA,cAAa,CAAUhC,CAAC,CAAEiC,gBAAgB;AACnD,GAAA/B,eAAO,mBAAkBF,CAAC,CAACc,WAAW,CAACoB,eAAe,MAAKD,gBAAgB,KAAI;AAC/EjC,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAGA,gBAAgB,CAAC;;AAEzCjC,CAAC,CAACc,WAAW,CAACoB,eAAe;AAC9B,GAAAnB,kBAAU,EAAC,+CAA+C,CAAC;AACrDqB,IAAI,CAAGC,2BAA2B,CAACrC,CAAC,CAAC;;AAEhBsC,iBAAQ,CAACC,MAAM,CAAC;AACvCC,IAAI,CAAE,MAAM;AACZC,IAAI,CAAE,UAAU;AAChBC,OAAO,CAAE,8BAA8B;AACvCC,OAAO,CAAEP,IAAI,CAACQ;AAClB,CAAC,CAAC,6CALM3C,QAAQ,uBAARA,QAAQ;;AAOhBD,CAAC,CAACc,WAAW,CAACoB,eAAe,CAAGjC,QAAQ;AACxCD,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAC6B,eAAe,CAAGjC,QAAQ;AACjDO,gBAAgB,CAACR,CAAC,CAAEA,CAAC,CAACS,KAAK,CAACL,OAAO,CAACC,MAAM,CAAEL,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAC,CAAC;;;AAGlEwC,cAAc,CAAC7C,CAAC,CAAC;AACjB8C,aAAa,CAAC9C,CAAC,CAAC;AAChB+C,oBAAoB,CAAC/C,CAAC,CAAC;AACvBgD,uBAAuB,CAAChD,CAAC,CAAC;AAC1BiD,wBAAwB,CAACjD,CAAC,CAAC;AAC3BkD,oBAAoB,CAAClD,CAAC,CAAC,uEAChC,CAAC;;;AAEF,GAAMmD,0BAAyB,CAAG,QAA5BA,0BAAyB,CAAInD,CAAC,CAAK;AACrC,GAAAE,eAAO,EAAC,2BAA2B,CAAC;AACpC,GAAMkD,aAAY,CAAG;AACjB5B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACiD,aAAa,CAACC,GAAG,CAAC;AAC5C9B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACmD,MAAM,CAAC;AACjC/B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACoD,aAAa,CAAC,CAC3C;;;AAED,GAAMC,cAAa,CAAGzD,CAAC,CAACc,WAAW,CAAC4C,QAAQ,CAACC,kBAAkB,CAACC,GAAG,CAAC,SAAAC,CAAC,QAAIrC,cAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACkD,GAAG,UAAWO,CAAC,OAAM,GAAC;;AAEzH,GAAAC,yBAAc,EAACV,YAAY,CAAC;;AAE5B,GAAAW,0BAAe,EAACN,aAAa,CAAC;AAClC,CAAC;;AAED,GAAMZ,eAAc,CAAG,QAAjBA,eAAc,CAAU7C,CAAC;AAC3B,GAAAE,eAAO,oBAAmBF,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAG;;AAEvD,GAAIjC,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAE;AAC5BkB,yBAAyB,CAACnD,CAAC,CAAC;AAC5B,GAAIA,CAAC,CAACmC,OAAO,CAAC6B,SAAS,CAAE;AACrBhE,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAG9B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACkD,GAAG,CAAE,UAAU,CAAEtD,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAC;AACjG,CAAC,IAAM;AACHjC,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAG9B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACsB,cAAc,CAAE1B,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAC;AAChG;AACJ,CAAC,IAAM;AACHjC,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAG9B,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACsB,cAAc,CAAE1B,CAAC,CAACc,WAAW,CAACoB,eAAe,CAAC;AACnG;;AAEAlC,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACgE,cAAc,CAAGzC,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAEY,wCAA6B,CAAC,CAAC;;AAE5FvC,WAAE,CAACC,UAAU,CAAC5B,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACgE,cAAc,CAAC;AAC/C,GAAAlD,kBAAU,mBAAkBC,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACgE,cAAc,CAAC,gCAA+BjD,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAC,cAAa,CAAC;AAC/I,IAAI;;;AAGf,GAAApD,eAAO,oBAAmBF,CAAC,CAACmC,OAAO,CAACF,gBAAgB,KAAIjC,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAItC,cAAK,CAACmD,IAAI,CAAC;;AAE3FnE,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACuD,aAAa,CAAGhC,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAE,YAAY,CAAC;AAC9EtD,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACmE,gBAAgB,CAAG5C,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAE,eAAe,CAAC;AACpFtD,CAAC,CAACmC,OAAO,CAACD,eAAe,CAAGlC,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAC6B,eAAe;AAClE,GAAI,CAAClC,CAAC,CAACmC,OAAO,CAACD,eAAe,CAAE;AAC5BlC,CAAC,CAACmC,OAAO,CAACD,eAAe,CAAGmC,MAAM,CAACC,IAAI,CAACtE,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC5EN,CAAC,CAACmC,OAAO,CAACoC,2BAA2B,CAAG,IAAI;AAChD,CAAC;;AAEK,GAAAC,0BAAY,EAACxE,CAAC,CAAEA,CAAC,CAACmC,OAAO,CAACsC,KAAK,CAAC;AACtC,GAAAC,iCAAmB,EAAC1E,CAAC,CAAE,CAAC,CAACA,CAAC,CAACmC,OAAO,CAACF,gBAAgB,CAAC,CAAC;;AAE9C,IAAI,wEACd;;;AAED,GAAMa,cAAa,CAAG,QAAhBA,cAAa,CAAG9C,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;;AAExD,GAAAX,eAAO,EAAC,4BAA4B,CAAEc,cAAK,CAACmD,IAAI,CAAC;AACjD,GAAI,CAACxC,WAAE,CAACC,UAAU,CAAC5B,CAAC,CAACS,KAAK,CAACL,OAAO,CAACmD,MAAM,CAAC,CAAE;AACxC,GAAAoB,eAAO,gCAA+B3D,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACmD,MAAM,CAAC,0CAAyC;AAClH,GAAAqB,0CAA+B,EAACpD,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAE,KAAK,CAAC,CAAEtD,CAAC,CAACS,KAAK,CAACL,OAAO,CAACmD,MAAM,CAAC;AACnG;AACA3C,OAAO,EAAE;AACb,CAAC,CAAC;;;AAGF,GAAMmC,qBAAoB,CAAG,QAAvBA,qBAAoB,CAAU/C,CAAC;;AAEjC,GAAAE,eAAO,EAAC,mCAAmC,CAAEc,cAAK,CAACmD,IAAI,CAAC,CAAC;;AAEpDxC,WAAE,CAACC,UAAU,CAAC5B,CAAC,CAACS,KAAK,CAACL,OAAO,CAACoD,aAAa,CAAC;AAC7C,GAAAmB,eAAO;AACiC3D,cAAK,CAACC,KAAK;AAC3CjB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACoD,aAAa,CAChC,wDACJ;;;;;AAGD,GAAAoB,0CAA+B,EAAC5E,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACuD,aAAa,CAAExD,CAAC,CAACS,KAAK,CAACL,OAAO,CAACoD,aAAa,CAAC;;AAExFqB,YAAY,CAAG,GAAAC,uCAAyB,EAAC9E,CAAC,CAAE,IAAI,CAAC;;;;AAInD6E,YAAY,CAACE,OAAO,CAAC,SAACC,CAAC,CAAK;AACxB,GAAMC,cAAa,CAAGzD,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACoD,aAAa,CAAEwB,CAAC,CAAEE,+BAAoB,CAAC;AACvF,GAAMC,UAAS,CAAG,GAAAC,yBAAc,EAACH,aAAa,CAAC;AAC/C,GAAIE,SAAS,CAAE;AACXA,SAAS,CAACE,MAAM,CAAGF,SAAS,CAACE,MAAM,EAAI,CAAC,CAAC;AACzC,GAAI,CAACrF,CAAC,CAACmC,OAAO,CAAC6B,SAAS,CAAE;AACtBmB,SAAS,CAACE,MAAM,CAACC,KAAK,wBAAGtF,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,uCAAtB,sBAAwBqD,QAAQ,eAAhC,uBAAkC4B,KAAK;AAChEH,SAAS,CAACE,MAAM,CAACE,EAAE,yBAAGvF,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,uCAAtB,uBAAwBqD,QAAQ,eAAhC,uBAAkC6B,EAAE;AAC9D;;AAEA/E,gBAAgB,CAACR,CAAC,CAAEiF,aAAa,CAAEE,SAAS,CAAC;AACjD;AACJ,CAAC,CAAC;;AAEIK,QAAQ,mBAAGxF,CAAC,CAACG,KAAK,CAACC,OAAO,sCAAf,iBAAiBsD,QAAQ,eAAzB,sBAA2BC,kBAAkB;;AAE9D,GAAI6B,QAAQ,CAAE;AACV,IAAWC,EAAE,GAAIN,UAAS,CAACO,SAAS,CAAE;AAClC,GAAI,CAACF,QAAQ,CAACG,QAAQ,CAACF,EAAE,CAAC,CAAE;AACxB,MAAON,UAAS,CAACO,SAAS,CAACD,EAAE,CAAC;AAClC;AACJ;AACJ,CAAC;AACK,GAAAG,0BAAY,EAAC5F,CAAC,CAAE,IAAI,CAAC;;AAE3B,GAAA6F,gBAAQ,eAAG,CAAC,0EAGvB;;;;;AAED,GAAM7C,wBAAuB,CAAG,QAA1BA,wBAAuB,CAAGhD,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;;AAElE,GAAAX,eAAO,EAAC,uCAAuC,CAAEc,cAAK,CAACmD,IAAI,CAAC;AAC5D,GAAI,CAACxC,WAAE,CAACC,UAAU,CAAC5B,CAAC,CAACS,KAAK,CAACL,OAAO,CAACiD,aAAa,CAACC,GAAG,CAAC,CAAE;AACnD,GAAAqB,eAAO;AACqC3D,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACiD,aAAa,CAACC,GAAG,CAAC,0CACzF;;AACD,GAAAsB,0CAA+B,EAAC5E,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACmE,gBAAgB,CAAEpE,CAAC,CAACS,KAAK,CAACL,OAAO,CAACiD,aAAa,CAACC,GAAG,CAAC;AACzG;AACA1C,OAAO,EAAE;AACb,CAAC,CAAC;;AAEF,GAAMqC,yBAAwB,CAAG,QAA3BA,yBAAwB,CAAGjD,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;;AAEnE,GAAMiF,eAAc,CAAG,GAAAV,yBAAc,EAACpF,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACgE,cAAc,CAAC;AACtE,GAAA/D,eAAO,EAAC,sCAAsC,CAAEc,cAAK,CAACmD,IAAI,CAAC;AAC3D,GAAI,CAACnE,CAAC,CAACmC,OAAO,CAAC6B,SAAS,CAAE;AACtB,GAAIhE,CAAC,CAACmC,OAAO,CAACF,gBAAgB,EAAIjC,CAAC,CAACmC,OAAO,CAACoC,2BAA2B,EAAIvE,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAC0F,KAAK,CAAE;AACrG,GAAAhF,kBAAU;AACaf,CAAC,CAACS,KAAK,CAACL,OAAO,CAACC,MAAM,6BAA4BL,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACgE,cAAc,CACvG;;AACD,GAAM+B,UAAS,CAAG,GAAAC,uBAAY,EAACjG,CAAC,CAAEA,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAEyF,cAAc,CAAE,KAAK,CAAE,IAAI,CAAC;AACtFE,SAAS,CAAC9D,eAAe,CAAGlC,CAAC,CAACmC,OAAO,CAACD,eAAe;AACrD8D,SAAS,CAACD,KAAK,CAAG,IAAI;AACtB,MAAOC,UAAS,CAACD,KAAK;AACtB/F,CAAC,CAACG,KAAK,CAACC,OAAO,CAACC,MAAM,CAAG2F,SAAS;AAClCxF,gBAAgB,CAACR,CAAC,CAAEA,CAAC,CAACS,KAAK,CAACL,OAAO,CAACC,MAAM,CAAE2F,SAAS,CAAC;AAC1D;AACJ,CAAC,IAAM;AACH,GAAIF,cAAc,CAACI,OAAO,CAACC,QAAQ,CAAE;AACjCL,cAAc,CAACI,OAAO,CAACC,QAAQ,CAAG,GAAAC,mCAAsB,GAAE;AAC9D;AACA5F,gBAAgB,CAACR,CAAC,CAAEA,CAAC,CAACS,KAAK,CAACL,OAAO,CAACiG,WAAW,CAAEP,cAAc,CAAC;AACpE;AACAlF,OAAO,EAAE;AACb,CAAC,CAAC;;AAEK,GAAMsC,qBAAoB,CAAG,QAAvBA,qBAAoB,CAAGlD,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;AACtE,GAAAX,eAAO,EAAC,sBAAsB,CAAC;;;;;;;;;AAS/B,GAAI;AACA,GAAI,CAACyB,WAAE,CAACC,UAAU,CAAC5B,CAAC,CAACS,KAAK,CAAC0E,SAAS,CAAC9E,MAAM,CAAC,CAAE;AAC1C,GAAAU,kBAAU,sCAAqCf,CAAC,CAACS,KAAK,CAAC0E,SAAS,CAAC9E,MAAM,mBAAkB;AACzFO,OAAO,EAAE;AACT;AACJ;AACA,GAAI0F,KAAI;AACR,GAAMzC,EAAC,CAAG7D,CAAC,CAACc,WAAW,CAAC4E,SAAS;AACjC,GAAM/B,mBAAkB,wBAAG3D,CAAC,CAACc,WAAW,CAAC4C,QAAQ,eAAtB,sBAAwBC,kBAAkB;AACrE,IAAK,GAAMzC,EAAC,GAAI2C,EAAC,CAAE;AACf,GAAIF,kBAAkB,EAAIA,kBAAkB,CAACgC,QAAQ,CAACzE,CAAC,CAAC,EAAI,CAACyC,kBAAkB,CAAE;AAC7E2C,IAAI,CAAGzC,CAAC,CAAC3C,CAAC,CAAC;AACX,GAAMqF,OAAM,CAAG/E,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACR,QAAQ,CAACqD,GAAG,CAAKgD,IAAI,CAACE,SAAS,OAAM;AACtE,GAAMC,aAAY,CAAGjF,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACiG,GAAG,CAACC,eAAe,CAACrD,GAAG,CAAE,OAAO,CAAKgD,IAAI,CAACE,SAAS,OAAM;AAChG,GAAMI,KAAI,CAAGpF,aAAI,CAACC,IAAI,CAACzB,CAAC,CAACS,KAAK,CAACL,OAAO,CAACkD,GAAG,CAAKgD,IAAI,CAACE,SAAS,OAAM;AACnE,GAAI,CAAC7E,WAAE,CAACC,UAAU,CAACgF,IAAI,CAAC,CAAE;AACtB,GAAI,CAACN,IAAI,CAACE,SAAS,CAAE;AACjB,GAAAzF,kBAAU,+BAA8BC,cAAK,CAACC,KAAK,CAACC,CAAC,CAAC,sBAAqBF,cAAK,CAACC,KAAK,CAACjB,CAAC,CAACS,KAAK,CAAC0E,SAAS,CAAC9E,MAAM,CAAC,KAAI;AACxH,CAAC,IAAM,IAAI,CAACsB,WAAE,CAACC,UAAU,CAAC2E,MAAM,CAAC,CAAE;AAC/B,GAAA5B,eAAO,4BAA2B3D,cAAK,CAACC,KAAK,CAACsF,MAAM,CAAC,mEAAkEvF,cAAK,CAACC,KAAK,CAACwF,YAAY,CAAC,KAAI;AACpJ,GAAAI,uBAAY,EAACJ,YAAY,CAAEG,IAAI,CAAC;AACpC,CAAC,IAAM;AACH,GAAAjC,eAAO,4BAA2B3D,cAAK,CAACC,KAAK,CAACqF,IAAI,CAACE,SAAS,CAAC,+CAA8C;AAC3G,GAAAK,uBAAY,EAACN,MAAM,CAAEK,IAAI,CAAC;AAC9B;AACJ;AACJ,CAAC,IAAM;AACH,GAAA7F,kBAAU,oBAAmBC,cAAK,CAACC,KAAK,CAACC,CAAC,CAAC,yDAAwDF,cAAK,CAACC,KAAK,CAAC,kDAAkD,CAAC,YAAW;AACjL;AACJ;AACJ,CAAE,MAAO6F,CAAC,CAAE;AACRjG,MAAM,EAAE;AACR;AACJ;;AAEAD,OAAO,EAAE;AACb,CAAC,CAAC,GAAC;;AAEH,GAAMJ,iBAAgB,CAAG,QAAnBA,iBAAgB,CAAIR,CAAC,CAAE6D,CAAC,CAAEkD,CAAC,CAAK;AAClC,GAAAC,wBAAa,EAACnD,CAAC,CAAEkD,CAAC,CAAC;AACnB,GAAAE,iCAAmB,EAACjH,CAAC,CAAC;AAC1B,CAAC;;AAEM,GAAMkH,mBAAkB,CAAG,QAArBA,mBAAkB,CAAGlH,CAAC,QAAI,GAAAmH,uBAAe,EAACnH,CAAC,CAACc,WAAW,CAACsG,gBAAgB,CAAE,KAAK,CAAE,IAAI,CAAE,SAACC,CAAC,CAAEjG,GAAG,CAAEkG,OAAO,CAAEC,UAAU,CAAK;AACjI,GAAMC,OAAM,wBAAGxH,CAAC,CAACc,WAAW,CAACR,SAAS,eAAvB,sBAA0BiH,UAAU,CAAC;AACpD,GAAME,UAAS,CAAGD,MAAM,CAAGxG,cAAK,CAAC0G,MAAM,CAAC,cAAc,CAAC,CAAG,EAAE;AAC5D,WAAY1G,cAAK,CAACmD,IAAI,CAACkD,CAAC,CAAG,CAAC,CAAC,OAAMrG,cAAK,CAAC2G,IAAI,CAACJ,UAAU,CAAC,CAAGE,SAAS;AACzE,CAAC,CAAC,GAAC;;AAEI,GAAMpF,4BAA2B,CAAG,QAA9BA,4BAA2B,CAAIrC,CAAC,CAAK;AAC9C,GAAIA,CAAC,CAACc,WAAW,CAACR,SAAS,CAAE;AACzB,MAAO,GAAA6G,uBAAe,EAACnH,CAAC,CAACc,WAAW,CAACR,SAAS,CAAC;AACnD;AACA,GAAAuF,gBAAQ,EAAC,+CAA+C,CAAE,KAAK,CAAE,IAAI,CAAC;AACtE,MAAO,EAAE;AACb,CAAC,CAAC;;;AAGK,GAAM+B,gBAAe,CAAG,QAAlBA,gBAAe,CAAG5H,CAAC,QAAI,IAAIW,QAAO,CAAC,SAACC,OAAO,CAAEC,MAAM,CAAK;AACjE,GAAAX,eAAO,EAAC,iBAAiB,CAAC;AAC1B,GAAMkC,KAAI,CAAG8E,kBAAkB,CAAClH,CAAC,CAAC;AAClC,GAAA6H,oBAAY,mBAAkBzF,IAAI,CAAC0F,QAAQ,CAAG;AAC9ClH,OAAO,EAAE;AACb,CAAC,CAAC,GAAC;;AAEI,GAAMmH,eAAc,CAAG,QAAjBA,eAAc,CAAU/H,CAAC;AAClC,GAAAE,eAAO,EAAC,gBAAgB,CAAC;;AAEnBkC,IAAI,CAAG8E,kBAAkB,CAAClH,CAAC,CAAC;;AAEPsC,iBAAQ,CAACC,MAAM,CAAC;AACvCC,IAAI,CAAE,MAAM;AACZE,OAAO,CAAE,gCAAgC;AACzCD,IAAI,CAAE,UAAU;AAChBE,OAAO,CAAEP,IAAI,CAACQ;AAClB,CAAC,CAAC,+CALM3C,QAAQ,wBAARA,QAAQ;;AAOhBF,WAAW,CAACC,CAAC,CAAEC,QAAQ,CAAC,CAAC,qEAC5B,CAAC;;;AAEK,GAAM+H,iBAAgB,CAAG,QAAnBA,iBAAgB,CAAUhI,CAAC;AACpC,GAAAE,eAAO,sBAAqBF,CAAC,CAACiI,OAAO,CAAChI,QAAQ,CAAG,CAAC;;AAE9CD,CAAC,CAACiI,OAAO,CAAChI,QAAQ;AACX+B,aAAa,CAAChC,CAAC,CAAEA,CAAC,CAACiI,OAAO,CAAChI,QAAQ,CAAC;;AAEzCmC,IAAI,CAAGC,2BAA2B,CAACrC,CAAC,CAAC;;AAEhBsC,iBAAQ,CAACC,MAAM,CAAC;AACvCC,IAAI,CAAE,MAAM;AACZE,OAAO,CAAE,gCAAgC;AACzCD,IAAI,CAAE,UAAU;AAChBE,OAAO,CAAEP,IAAI,CAACQ;AAClB,CAAC,CAAC,+CALM3C,QAAQ,wBAARA,QAAQ;;AAOhB+B,aAAa,CAAChC,CAAC,CAAEC,QAAQ,CAAC,CAAC,qEAC9B,CAAC"}