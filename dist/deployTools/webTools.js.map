{"version":3,"file":"webTools.js","names":["DEPLOY_TARGET_DOCKER","DEPLOY_TARGET_FTP","DEPLOY_TARGET_NOW","DEPLOY_TARGET_NONE","_runDeployment","c","platform","deployType","deployToFtp","deployToNow","Promise","resolve","rnvPath","process","mainModule","filename","split","deployToDocker","importPackageFromProject","setRNVPath","doDeploy","reject","Error","_runExport","doExport","selectToolAndExecute","choices","configFunction","executeFunction","isDeploy","argv","minimist","slice","type","t","targetConfig","buildConfig","platforms","deploy","inquirer","prompt","name","message","chalk","white","selectedTarget","logInfo","paths","appConfig","config","selectWebToolAndDeploy","configureDeploymentIfRequired","selectWebToolAndExport","configureExportIfRequired"],"sources":["../../src/deployTools/webTools.js"],"sourcesContent":["import chalk from 'chalk';\nimport minimist from 'minimist';\nimport inquirer from 'inquirer';\nimport path from 'path';\n\nimport { deployToNow } from './now';\nimport { deployToFtp } from './ftp';\nimport {\n    importPackageFromProject\n} from '../common';\nimport {\n    logInfo\n} from '../systemTools/logger';\nimport { configureDeploymentIfRequired, configureExportIfRequired } from './configure';\n\nconst DEPLOY_TARGET_DOCKER = 'docker';\nconst DEPLOY_TARGET_FTP = 'ftp';\nconst DEPLOY_TARGET_NOW = 'now';\nconst DEPLOY_TARGET_NONE = 'none';\n\nconst _runDeployment = async (c, platform, deployType) => {\n    switch (deployType) {\n        case DEPLOY_TARGET_FTP:\n            return deployToFtp(c, platform);\n        case DEPLOY_TARGET_NOW:\n            return deployToNow(c, platform);\n        case DEPLOY_TARGET_NONE:\n            return Promise.resolve();\n        case DEPLOY_TARGET_DOCKER:\n            const rnvPath = process.mainModule.filename.split('/bin/index.js')[0];\n            const deployToDocker = importPackageFromProject('@rnv/deploy-docker');\n            deployToDocker.setRNVPath(rnvPath);\n            return deployToDocker.doDeploy();\n        default:\n            return Promise.reject(new Error(`Deploy Type not supported ${deployType}`));\n    }\n};\n\nconst _runExport = (c, platform, deployType) => {\n    switch (deployType) {\n        case DEPLOY_TARGET_DOCKER:\n            const rnvPath = process.mainModule.filename.split('/bin/index.js')[0];\n            const deployToDocker = importPackageFromProject('@rnv/deploy-docker');\n            deployToDocker.setRNVPath(rnvPath);\n            return deployToDocker.doExport();\n        default:\n            return Promise.reject(new Error(`Deploy Type not supported ${deployType}`));\n    }\n};\n\nconst selectToolAndExecute = async ({\n    c, platform, choices, configFunction, executeFunction, isDeploy = true\n}) => {\n    const argv = minimist(c.process.argv.slice(2));\n    const type = argv.t;\n    const targetConfig = c.buildConfig.platforms[platform];\n\n    if (type || (targetConfig && targetConfig.deploy && targetConfig.deploy.type)) {\n        await configFunction(type || targetConfig.deploy.type);\n        return executeFunction(c, platform, type || targetConfig.deploy.type);\n    }\n    const { selectedTarget } = await inquirer.prompt({\n        name: 'selectedTarget',\n        type: 'list',\n        choices,\n        message: `Which type of ${isDeploy ? 'deploy' : 'export'} option would you like to use for ${chalk.white(platform)}?`\n    });\n\n    await configFunction(selectedTarget);\n\n    logInfo(`Setting your appconfig for ${chalk.white(platform)} to include ${isDeploy ? 'deploy' : 'export'} type: ${chalk.white(selectedTarget)} at ${chalk.white(c.paths.appConfig.config)}`);\n    return executeFunction(c, platform, selectedTarget);\n};\n\nconst selectWebToolAndDeploy = (c, platform) => selectToolAndExecute({\n    c,\n    platform,\n    choices: [DEPLOY_TARGET_DOCKER, DEPLOY_TARGET_FTP, DEPLOY_TARGET_NOW, DEPLOY_TARGET_NONE],\n    configFunction: configureDeploymentIfRequired,\n    executeFunction: _runDeployment\n});\n\nconst selectWebToolAndExport = (c, platform) => selectToolAndExecute({\n    c,\n    platform,\n    choices: [DEPLOY_TARGET_DOCKER],\n    configFunction: configureExportIfRequired,\n    executeFunction: _runExport,\n    isDeploy: false\n});\n\nexport {\n    selectWebToolAndDeploy,\n    selectWebToolAndExport,\n    DEPLOY_TARGET_FTP,\n    DEPLOY_TARGET_NOW,\n    DEPLOY_TARGET_NONE\n};\n"],"mappings":"+WAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;;AAGA;;AAEA,GAAMA,qBAAoB,CAAG,QAAQ;AACrC,GAAMC,kBAAiB,CAAG,KAAK,CAAC;AAChC,GAAMC,kBAAiB,CAAG,KAAK,CAAC;AAChC,GAAMC,mBAAkB,CAAG,MAAM,CAAC;;AAElC,GAAMC,eAAc,CAAG,QAAjBA,eAAc,CAAUC,CAAC,CAAEC,QAAQ,CAAEC,UAAU;AACzCA,UAAU;AACTN,iBAAiB;;AAEjBC,iBAAiB;;AAEjBC,kBAAkB;;AAElBH,oBAAoB,mDALd,GAAAQ,gBAAW,EAACH,CAAC,CAAEC,QAAQ,CAAC,yCAExB,GAAAG,gBAAW,EAACJ,CAAC,CAAEC,QAAQ,CAAC,yCAExBI,OAAO,CAACC,OAAO,EAAE;AAElBC,OAAO,CAAGC,OAAO,CAACC,UAAU,CAACC,QAAQ,CAACC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;AAC/DC,cAAc,CAAG,GAAAC,gCAAwB,EAAC,oBAAoB,CAAC;AACrED,cAAc,CAACE,UAAU,CAACP,OAAO,CAAC,CAAC;AAC5BK,cAAc,CAACG,QAAQ,EAAE;;AAEzBV,OAAO,CAACW,MAAM,CAAC,GAAIC,MAAK,8BAA8Bf,UAAU,CAAG,CAAC,uEAEtF;;;;AAED,GAAMgB,WAAU,CAAG,QAAbA,WAAU,CAAIlB,CAAC,CAAEC,QAAQ,CAAEC,UAAU,CAAK;AAC5C,OAAQA,UAAU;AACd,IAAKP,qBAAoB;AACrB,GAAMY,QAAO,CAAGC,OAAO,CAACC,UAAU,CAACC,QAAQ,CAACC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;AACrE,GAAMC,eAAc,CAAG,GAAAC,gCAAwB,EAAC,oBAAoB,CAAC;AACrED,cAAc,CAACE,UAAU,CAACP,OAAO,CAAC;AAClC,MAAOK,eAAc,CAACO,QAAQ,EAAE;AACpC;AACI,MAAOd,QAAO,CAACW,MAAM,CAAC,GAAIC,MAAK,8BAA8Bf,UAAU,CAAG,CAAC,CAAC;;AAExF,CAAC;;AAED,GAAMkB,qBAAoB,CAAG,QAAvBA,qBAAoB;AACtBpB,CAAC,MAADA,CAAC,CAAEC,QAAQ,MAARA,QAAQ,CAAEoB,OAAO,MAAPA,OAAO,CAAEC,cAAc,MAAdA,cAAc,CAAEC,eAAe,MAAfA,eAAe,oBAAEC,QAAQ,CAARA,QAAQ,wBAAG,IAAI;;AAEhEC,IAAI,CAAG,GAAAC,iBAAQ,EAAC1B,CAAC,CAACQ,OAAO,CAACiB,IAAI,CAACE,KAAK,CAAC,CAAC,CAAC,CAAC;AACxCC,IAAI,CAAGH,IAAI,CAACI,CAAC;AACbC,YAAY,CAAG9B,CAAC,CAAC+B,WAAW,CAACC,SAAS,CAAC/B,QAAQ,CAAC;;AAElD2B,IAAI,EAAKE,YAAY,EAAIA,YAAY,CAACG,MAAM,EAAIH,YAAY,CAACG,MAAM,CAACL,IAAK;AACnEN,cAAc,CAACM,IAAI,EAAIE,YAAY,CAACG,MAAM,CAACL,IAAI,CAAC;AAC/CL,eAAe,CAACvB,CAAC,CAAEC,QAAQ,CAAE2B,IAAI,EAAIE,YAAY,CAACG,MAAM,CAACL,IAAI,CAAC;;AAExCM,iBAAQ,CAACC,MAAM,CAAC;AAC7CC,IAAI,CAAE,gBAAgB;AACtBR,IAAI,CAAE,MAAM;AACZP,OAAO,CAAPA,OAAO;AACPgB,OAAO,mBAAmBb,QAAQ,CAAG,QAAQ,CAAG,QAAQ,uCAAqCc,cAAK,CAACC,KAAK,CAACtC,QAAQ,CAAC;AACtH,CAAC,CAAC,+CALMuC,cAAc,uBAAdA,cAAc;;AAOhBlB,cAAc,CAACkB,cAAc,CAAC;;AAEpC,GAAAC,eAAO,gCAA+BH,cAAK,CAACC,KAAK,CAACtC,QAAQ,CAAC,iBAAeuB,QAAQ,CAAG,QAAQ,CAAG,QAAQ,YAAUc,cAAK,CAACC,KAAK,CAACC,cAAc,CAAC,QAAOF,cAAK,CAACC,KAAK,CAACvC,CAAC,CAAC0C,KAAK,CAACC,SAAS,CAACC,MAAM,CAAC,CAAG,CAAC;AACtLrB,eAAe,CAACvB,CAAC,CAAEC,QAAQ,CAAEuC,cAAc,CAAC,wEACtD;;;AAED,GAAMK,uBAAsB,CAAG,QAAzBA,uBAAsB,CAAI7C,CAAC,CAAEC,QAAQ,QAAKmB,qBAAoB,CAAC;AACjEpB,CAAC,CAADA,CAAC;AACDC,QAAQ,CAARA,QAAQ;AACRoB,OAAO,CAAE,CAAC1B,oBAAoB,CAAEC,iBAAiB,CAAEC,iBAAiB,CAAEC,kBAAkB,CAAC;AACzFwB,cAAc,CAAEwB,wCAA6B;AAC7CvB,eAAe,CAAExB;AACrB,CAAC,CAAC,GAAC;;AAEH,GAAMgD,uBAAsB,CAAG,QAAzBA,uBAAsB,CAAI/C,CAAC,CAAEC,QAAQ,QAAKmB,qBAAoB,CAAC;AACjEpB,CAAC,CAADA,CAAC;AACDC,QAAQ,CAARA,QAAQ;AACRoB,OAAO,CAAE,CAAC1B,oBAAoB,CAAC;AAC/B2B,cAAc,CAAE0B,oCAAyB;AACzCzB,eAAe,CAAEL,UAAU;AAC3BM,QAAQ,CAAE;AACd,CAAC,CAAC,GAAC"}