{"version":3,"file":"now.js","names":["_runDeploymentTask","c","nowConfigPath","Promise","resolve","reject","dotenv","config","defaultBuildFolder","path","join","getAppFolder","params","process","env","NOW_TOKEN","push","nowIsProduction","getConfigProp","platform","executeAsync","then","catch","error","_createConfigFiles","configFilePath","envConfigPath","nowParamsExists","envContent","fs","existsSync","content","public","version","logInfo","chalk","white","inquirer","prompt","type","name","message","validate","i","token","writeFileSync","JSON","stringify","deployToNow","paths","project","dir","readFileSync","toString","err","matched","split","map","line","forEach","key","indexOf"],"sources":["../../src/deployTools/now.js"],"sourcesContent":["import chalk from 'chalk';\nimport path from 'path';\nimport fs from 'fs';\nimport inquirer from 'inquirer';\nimport dotenv from 'dotenv';\n\nimport { executeAsync } from '../systemTools/exec';\nimport { getAppFolder, getConfigProp } from '../common';\nimport { logInfo } from '../systemTools/logger';\n\nconst _runDeploymentTask = (c, nowConfigPath) => new Promise((resolve, reject) => {\n    dotenv.config();\n    const defaultBuildFolder = path.join(getAppFolder(c, 'web'), 'public');\n    const params = [defaultBuildFolder, '-A', nowConfigPath];\n    if (process.env.NOW_TOKEN) params.push('-t', process.env.NOW_TOKEN);\n    const nowIsProduction = getConfigProp(c, c.platform, 'nowIsProduction', false) === true;\n\n    if (nowIsProduction) params.push('--prod');\n\n    executeAsync(c, `now ${params.join(' ')}`)\n        .then(() => resolve())\n        .catch(error => reject(error));\n});\n\nconst _createConfigFiles = async (configFilePath, envConfigPath, nowParamsExists = false, envContent = '') => {\n    if (!fs.existsSync(configFilePath)) {\n        const content = { public: true, version: 2 };\n        logInfo(`${chalk.white('now.json')} file does not exist. Creating one for you`);\n\n        const { name } = await inquirer.prompt([{\n            type: 'input',\n            name: 'name',\n            message: 'What is your project name?',\n            validate: i => !!i || 'Please enter a name'\n        }, {\n            type: 'input',\n            name: 'token',\n            message: 'Do you have now token? If no leave empty and you will be asked to create one'\n        }]);\n\n        content.name = name;\n\n        if (!nowParamsExists) {\n            const { token } = await inquirer.prompt({\n                type: 'input',\n                name: 'token',\n                message: 'Do you have now token? If no leave empty and you will be asked to create one'\n            });\n            if (token) {\n                envContent += `NOW_TOKEN=${token}\\n`;\n                fs.writeFileSync(envConfigPath, envContent);\n            }\n            return fs.writeFileSync(configFilePath, JSON.stringify(content, null, 2));\n        }\n        return fs.writeFileSync(configFilePath, JSON.stringify(content, null, 2));\n    }\n};\n\nconst deployToNow = c => new Promise((resolve, reject) => {\n    const nowConfigPath = path.resolve(c.paths.project.dir, 'now.json');\n    const envConfigPath = path.resolve(c.paths.project.dir, '.env');\n\n    let envContent;\n    try {\n        envContent = fs.readFileSync(envConfigPath).toString();\n    } catch (err) {\n        envContent = '';\n    }\n\n    let matched = false;\n    envContent.split('\\n').map(line => line.split('=')).forEach(([key]) => {\n        if (['NOW_TOKEN'].indexOf(key) > -1) {\n            matched = true;\n        }\n    });\n\n    _createConfigFiles(nowConfigPath, envConfigPath, matched, envContent)\n        .then(() => {\n            _runDeploymentTask(c, nowConfigPath)\n                .then(() => {\n                    resolve();\n                })\n                .catch(err => reject(err));\n        });\n});\n\nexport { deployToNow };\n"],"mappings":"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"}