{"version":3,"sources":["../../src/pluginTools/index.js"],"names":["rnvPluginList","c","Promise","resolve","o","_getPluginList","asString","isUpdate","output","asArray","plugins","allPlugins","i","Object","keys","files","rnv","pluginTemplates","configs","forEach","pk","k","p","platforms","SUPPORTED_PLATFORMS","v","length","slice","installedPlugin","buildConfig","installedString","chalk","yellow","green","push","versionString","version","bold","name","value","grey","sort","a","b","aStr","toLowerCase","bStr","com","rnvPluginAdd","inquirer","prompt","type","message","choices","pageSize","plugin","installMessage","selectedPlugins","white","questionPlugins","key","props","project","config","_checkAndAddDependantPlugins","pluginKeys","pluginKey","pluginProps","finalProps","i2","propValue","spinner","join","start","paths","succeed","dependsOn","templatePlugins","console","log","rnvPluginUpdate","confirm","json","getMergedPlugin","noMerge","rnvPlugin","origPlugin","String","scope","split","pop","skipMerge","_getMergedPlugin","source","mergedPlugin","obj1","obj2","obj","_refs","configurePlugins","reject","package","dependencies","hasPackageChanged","devDependencies","builds","runtime","isWrapper","red","npm","npmKey","npmDep","then","skipPackageUpdate","_requiresNpmInstall","catch","e","parsePlugins","platform","pluginCallback","includedPlugins","excludedPlugins","includes","pluginPlat","enabled","deprecated","appConfig","getLocalRenativePlugin","webpack","modulePaths","moduleAliases","renative","projectPath"],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport inquirer from 'inquirer';\nimport ora from 'ora';\nimport { mergeObjects, writeFileSync, sanitizeDynamicProps } from '../systemTools/fileutils';\nimport { getConfigProp } from '../common';\nimport { versionCheck } from '../configTools/configParser';\n\nimport { SUPPORTED_PLATFORMS } from '../constants';\nimport {\n    logSuccess,\n    logTask, logWarning, logError, logToSummary\n} from '../systemTools/logger';\nimport { executePipe } from '../projectTools/buildHooks';\n\nexport const rnvPluginList = c => new Promise((resolve) => {\n    logTask('_runList');\n\n    const o = _getPluginList(c);\n\n    // console.log(o.asString);\n    logToSummary(`Plugins:\\n\\n${o.asString}`);\n\n    resolve();\n});\n\nconst _getPluginList = (c, isUpdate = false) => {\n    const output = {\n        asString: '',\n        asArray: [],\n        plugins: [],\n        allPlugins: {} // this is used by rnvPluginAdd\n    };\n\n    let i = 1;\n\n    Object.keys(c.files.rnv.pluginTemplates.configs).forEach((pk) => {\n        const plugins = c.files.rnv.pluginTemplates.configs[pk].pluginTemplates;\n        Object.keys(plugins).forEach((k) => {\n            const p = plugins[k];\n\n            let platforms = '';\n            SUPPORTED_PLATFORMS.forEach((v) => {\n                if (p[v]) platforms += `${v}, `;\n            });\n            if (platforms.length) platforms = platforms.slice(0, platforms.length - 2);\n            const installedPlugin = c.buildConfig && c.buildConfig.plugins && c.buildConfig.plugins[k];\n            const installedString = installedPlugin ? chalk.yellow('installed') : chalk.green('not installed');\n            if (isUpdate && installedPlugin) {\n                output.plugins.push(k);\n                let versionString;\n                if (installedPlugin.version !== p.version) {\n                    versionString = `(${chalk.yellow(installedPlugin.version)}) => (${chalk.green(p.version)})`;\n                } else {\n                    versionString = `(${chalk.green(installedPlugin.version)})`;\n                }\n                output.asString += ` [${i}]> ${chalk.bold(k)} ${versionString}\\n`;\n                output.asArray.push({ name: `${k} ${versionString}`, value: k });\n                output.allPlugins[k] = p; // this is used by rnvPluginAdd\n                i++;\n            } else if (!isUpdate) {\n                output.plugins.push(k);\n                output.asString += ` [${i}]> ${chalk.bold(k)} (${chalk.grey(p.version)}) [${platforms}] - ${installedString}\\n`;\n                output.asArray.push({ name: `${k} (${chalk.grey(p.version)}) [${platforms}] - ${installedString}`, value: k });\n                output.allPlugins[k] = p; // this is used by rnvPluginAdd\n\n                i++;\n            }\n            output.asArray.sort((a, b) => {\n                const aStr = a.name.toLowerCase();\n                const bStr = b.name.toLowerCase();\n                let com = 0;\n                if (aStr > bStr) {\n                    com = 1;\n                } else if (aStr < bStr) {\n                    com = -1;\n                }\n                return com;\n            });\n        });\n    });\n\n\n    return output;\n};\n\nexport const rnvPluginAdd = async (c) => {\n    logTask('rnvPluginAdd');\n\n    const o = _getPluginList(c);\n\n    const { plugin } = await inquirer.prompt({\n        name: 'plugin',\n        type: 'rawlist',\n        message: 'Select the plugins you want to add',\n        choices: o.asArray,\n        pageSize: 50\n    });\n\n    const installMessage = [];\n    const selectedPlugins = {};\n    selectedPlugins[plugin] = o.allPlugins[plugin];\n    installMessage.push(`${chalk.white(plugin)} v(${chalk.green(o.allPlugins[plugin].version)})`);\n\n    const questionPlugins = {}\n\n    Object.keys(selectedPlugins).forEach((key) => {\n        // c.buildConfig.plugins[key] = 'source:rnv';\n        const plugin = selectedPlugins[key]\n        if(plugin.props) questionPlugins[key] = plugin;\n        c.files.project.config.plugins[key] = 'source:rnv';\n\n        // c.buildConfig.plugins[key] = selectedPlugins[key];\n        _checkAndAddDependantPlugins(c, selectedPlugins[key]);\n    });\n\n    const pluginKeys = Object.keys(questionPlugins)\n    for(let i = 0; i < pluginKeys.length; i++) {\n        const pluginKey = pluginKeys[i]\n        const plugin = questionPlugins[pluginKey];\n        const pluginProps = Object.keys(plugin.props);\n        const finalProps = {}\n        for(let i2 = 0; i2 < pluginProps.length; i2 ++) {\n            const { propValue } = await inquirer.prompt({\n                name: 'propValue',\n                type: 'input',\n                message: `${pluginKey}: Add value for ${pluginProps[i2]} (You can do this later in ./renative.json file)`\n            });\n            finalProps[pluginProps[i2]] = propValue\n        }\n        c.files.project.config.plugins[pluginKey] = {}\n        c.files.project.config.plugins[pluginKey].props = finalProps\n    }\n\n    const spinner = ora(`Installing: ${installMessage.join(', ')}`).start();\n\n    writeFileSync(c.paths.project.config, c.files.project.config);\n    spinner.succeed('All plugins installed!');\n    logSuccess('Plugins installed successfully!');\n};\n\nconst _checkAndAddDependantPlugins = (c, plugin) => {\n    if (plugin.dependsOn) {\n        plugin.dependsOn.forEach((v) => {\n            Object.keys(c.files.rnv.pluginTemplates.configs).forEach((p) => {\n                const templatePlugins = c.files.rnv.pluginTemplates.configs[p].pluginTemplates;\n                if (templatePlugins[v]) {\n                    console.log(`Added dependant plugin ${v}`);\n                    c.buildConfig.plugins[v] = templatePlugins[v];\n                }\n            });\n        });\n    }\n};\n\nexport const rnvPluginUpdate = async (c) => {\n    logTask('rnvPluginUpdate');\n\n    const o = _getPluginList(c, true);\n\n    console.log(o.asString);\n\n    const { confirm } = await inquirer.prompt({\n        name: 'confirm',\n        type: 'confirm',\n        message: 'Above installed plugins will be updated with RNV',\n    });\n\n    if (confirm) {\n        const { plugins } = c.buildConfig;\n        Object.keys(plugins).forEach((key) => {\n            // c.buildConfig.plugins[key] = o.json[key];\n            c.files.project.config.plugins[key] = o.json[key];\n        });\n\n        writeFileSync(c.paths.project.config, c.files.project.config);\n\n        logSuccess('Plugins updated successfully!');\n    }\n};\n\nconst getMergedPlugin = (c, key, plugins, noMerge = false) => {\n    const plugin = plugins[key];\n\n    // const origPlugin = c.files.rnv.pluginTemplates.config.pluginTemplates[key];\n    const rnvPlugin = c.files.rnv.pluginTemplates.configs?.rnv?.pluginTemplates?.[key];\n\n    let origPlugin;\n    if (typeof plugin === 'string' || plugin instanceof String) {\n        const scope = plugin.split(':').pop();\n\n        origPlugin = c.files.rnv.pluginTemplates.configs[scope]?.pluginTemplates?.[key];\n\n        if (origPlugin) {\n            if (rnvPlugin && !origPlugin?.skipMerge) {\n                origPlugin = _getMergedPlugin(c, rnvPlugin, origPlugin, true, true);\n            }\n            return origPlugin;\n        }\n        logWarning(`Plugin ${key} is not recognized plugin in ${plugin} scope`);\n        return null;\n    }\n\n    if (plugin) {\n        if (plugin.source) {\n            origPlugin = c.files.rnv.pluginTemplates.configs[plugin.source]?.pluginTemplates?.[key];\n            if (rnvPlugin && !origPlugin?.skipMerge) {\n                origPlugin = _getMergedPlugin(c, rnvPlugin, origPlugin, true, true);\n            }\n        } else {\n            origPlugin = rnvPlugin;\n        }\n    }\n\n\n    if (origPlugin) {\n        const mergedPlugin = _getMergedPlugin(c, origPlugin, plugin, true, true);\n        return mergedPlugin;\n    }\n\n    return plugin;\n};\n\nconst _getMergedPlugin = (c, obj1, obj2) => {\n    const obj = sanitizeDynamicProps(mergeObjects(c, obj1, obj2, true, true), c.buildConfig?._refs);\n    return sanitizeDynamicProps(obj, obj.props);\n};\n\n\nexport const configurePlugins = c => new Promise((resolve, reject) => {\n    logTask('configurePlugins');\n\n    if (!c.files.project.package.dependencies) {\n        c.files.project.package.dependencies = {};\n    }\n\n    let hasPackageChanged = false;\n\n    for (const k in c.buildConfig.plugins) {\n        const { dependencies } = c.files.project.package;\n        const { devDependencies } = c.files.project.package;\n        const plugin = getMergedPlugin(c, k, c.buildConfig.plugins);\n\n        if (!plugin) {\n            logWarning(`Plugin with name ${\n                chalk.white(k)} does not exists in ReNative source:rnv scope. you need to define it manually here: ${\n                chalk.white(c.paths.project.builds.config)}`);\n        } else if (dependencies && dependencies[k]) {\n            if (plugin['no-active'] !== true && plugin['no-npm'] !== true && dependencies[k] !== plugin.version) {\n                if (k === 'renative' && c.runtime.isWrapper) {\n                    logWarning('You\\'re in ReNative wrapper mode. plugin renative will stay as local dep!');\n                } else {\n                    logWarning(\n                        `Version mismatch of dependency ${chalk.white(k)} between:\n  ${chalk.white(c.paths.project.package)}: v(${chalk.red(dependencies[k])}) and\n  ${chalk.white(c.paths.project.builds.config)}: v(${chalk.green(plugin.version)}).\n  package.json will be overriden`\n                    );\n\n                    hasPackageChanged = true;\n                    dependencies[k] = plugin.version;\n                }\n            }\n        } else if (devDependencies && devDependencies[k]) {\n            if (plugin['no-active'] !== true && plugin['no-npm'] !== true && devDependencies[k] !== plugin.version) {\n                logWarning(\n                    `Version mismatch of devDependency ${chalk.white(k)} between package.json: v(${chalk.red(\n                        devDependencies[k],\n                    )}) and plugins.json: v(${chalk.red(plugin.version)}). package.json will be overriden`,\n                );\n                hasPackageChanged = true;\n                devDependencies[k] = plugin.version;\n            }\n        } else if (plugin['no-active'] !== true && plugin['no-npm'] !== true) {\n            // Dependency does not exists\n            logWarning(\n                `Missing dependency ${chalk.white(k)} v(${chalk.red(\n                    plugin.version,\n                )}) in package.json. package.json will be overriden`,\n            );\n\n            hasPackageChanged = true;\n            dependencies[k] = plugin.version;\n        }\n\n        if (plugin && plugin.npm) {\n            for (const npmKey in plugin.npm) {\n                const npmDep = plugin.npm[npmKey];\n                if (dependencies[npmKey] !== npmDep) {\n                    logWarning(`Plugin ${chalk.white(k)} requires npm dependency ${chalk.white(npmKey)} .Adding missing npm dependency to you package.json`);\n                    dependencies[npmKey] = npmDep;\n                    hasPackageChanged = true;\n                }\n            }\n        }\n    }\n\n    logTask(`configurePlugins:${hasPackageChanged}`, chalk.grey);\n    versionCheck(c)\n        .then(() => {\n            if (hasPackageChanged && !c.runtime.skipPackageUpdate) {\n                writeFileSync(c.paths.project.package, c.files.project.package);\n                c._requiresNpmInstall = true;\n            }\n            resolve();\n        }).catch(e => reject(e));\n});\n\nconst parsePlugins = (c, platform, pluginCallback) => {\n    logTask(`parsePlugins:${platform}`);\n    if (c.buildConfig) {\n        const includedPlugins = getConfigProp(c, platform, 'includedPlugins', []);\n        const excludedPlugins = getConfigProp(c, platform, 'excludedPlugins', []);\n        if (includedPlugins) {\n            const { plugins } = c.buildConfig;\n            if (plugins) {\n                Object.keys(plugins).forEach((key) => {\n                    if ((includedPlugins.includes('*') || includedPlugins.includes(key)) && !excludedPlugins.includes(key)) {\n                        const plugin = getMergedPlugin(c, key, plugins);\n                        if (plugin) {\n                            const pluginPlat = plugin[platform];\n                            if (pluginPlat) {\n                                if (plugin['no-active'] !== true && plugin.enabled !== false && pluginPlat.enabled !== false) {\n                                    if (plugin.deprecated) {\n                                        logWarning(plugin.deprecated);\n                                    }\n                                    if (pluginCallback) pluginCallback(plugin, pluginPlat, key);\n                                } else {\n                                    logWarning(`Plugin ${key} is marked disabled. skipping.`);\n                                }\n                            }\n                        }\n                    }\n                });\n            } else {\n                logError(`You have no plugins defined in ${chalk.white(c.paths.project.builds.config)}`);\n            }\n        } else {\n            logWarning(`You haven't included any ${chalk.white('{ common: { includedPlugins: [] }}')} in your ${chalk.white(c.paths.appConfig.config)}. Your app might not work correctly`);\n        }\n    }\n};\n\nconst getLocalRenativePlugin = () => ({\n    version: 'file:./packages/renative',\n    webpack: {\n        modulePaths: [],\n        moduleAliases: {\n            renative: {\n                projectPath: 'packages/renative'\n            }\n        }\n    }\n});\n\nexport { getMergedPlugin, parsePlugins, getLocalRenativePlugin };\n\nexport default { getMergedPlugin, parsePlugins, getLocalRenativePlugin };\n"],"file":"index.js"}