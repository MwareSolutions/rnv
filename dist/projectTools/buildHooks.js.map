{"version":3,"sources":["../../src/projectTools/buildHooks.js"],"names":["rnvHooksRun","c","Promise","resolve","reject","buildHooks","then","program","exeMethod","catch","e","chalk","white","executePipe","key","pipe","buildPipes","Array","isArray","reduce","accumulatorPromise","next","fs","existsSync","paths","index","isBuildHooksReady","dir","dist","cwd","h","require","hooks","pipes","rnvHooksList","hookOpts","hooksAsString","asString","pipeOpts","rnvHooksPipes","console","log"],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport fs from 'fs';\nimport {\n    getConfig\n} from '../common';\nimport { logToSummary, logTask } from '../systemTools/logger';\nimport { generateOptions } from '../systemTools/prompt';\nimport { executeAsync } from '../systemTools/exec';\n\n// ##########################################\n// PUBLIC API\n// ##########################################\n\nconst rnvHooksRun = c => new Promise((resolve, reject) => {\n    logTask('rnvHooksRun');\n\n    buildHooks(c)\n        .then(() => {\n            if (!c.buildHooks) {\n                reject('Build hooks have not been compiled properly!');\n                return;\n            }\n            if (c.buildHooks[c.program?.exeMethod]) {\n                c.buildHooks[c.program?.exeMethod](c)\n                    .then(() => resolve())\n                    .catch(e => reject(e));\n            } else {\n                reject(`Method name ${chalk.white(c.program.exeMethod)} does not exists in your buildHooks!`);\n            }\n        })\n        .catch(e => reject(e));\n});\n\nconst executePipe = async (c, key) => {\n    logTask(`executePipe:${key}`);\n\n    await buildHooks(c);\n\n    const pipe = c.buildPipes ? c.buildPipes[key] : null;\n\n    if (Array.isArray(pipe)) {\n        await pipe.reduce((accumulatorPromise, next) => accumulatorPromise.then(() => next(c)), Promise.resolve());\n    } else if (pipe) {\n        await pipe(c);\n    }\n};\n\nconst buildHooks = c => new Promise((resolve, reject) => {\n    logTask('buildHooks');\n\n    if (fs.existsSync(c.paths.buildHooks.index)) {\n        if (c.isBuildHooksReady) {\n            resolve();\n            return;\n        }\n\n        executeAsync(c, `babel --no-babelrc --plugins @babel/plugin-proposal-optional-chaining,@babel/plugin-proposal-nullish-coalescing-operator ${c.paths.buildHooks.dir} -d ${c.paths.buildHooks.dist.dir} --presets=@babel/env`, {\n            cwd: c.paths.buildHooks.dir\n        })\n            .then(() => {\n                const h = require(c.paths.buildHooks.dist.index);\n                c.buildHooks = h.hooks;\n                c.buildPipes = h.pipes;\n                c.isBuildHooksReady = true;\n                resolve();\n            })\n            .catch((e) => {\n                // logWarning(`BUILD_HOOK Failed with error: ${e}`);\n                // resolve();\n                // Fail Builds instead of warn when hook fails\n                reject(`BUILD_HOOK Failed with error: ${e}`);\n            });\n    } else {\n        // logWarning(`Your buildHook ${chalk.white(c.paths.buildHooks.index)} is missing!. Skipping operation`);\n        resolve();\n    }\n});\n\nconst rnvHooksList = c => new Promise((resolve, reject) => {\n    logTask('rnvHooksList');\n\n    buildHooks(c)\n        .then(() => {\n            if (c.buildHooks) {\n                const hookOpts = generateOptions(c.buildHooks);\n                let hooksAsString = `\\n${'Hooks:'}\\n${hookOpts.asString}`;\n\n                if (c.buildPipes) {\n                    const pipeOpts = generateOptions(c.buildPipes);\n                    hooksAsString += `\\n${'Pipes:'}\\n${pipeOpts.asString}`;\n                }\n                logToSummary(hooksAsString);\n                resolve();\n            } else {\n                reject('Your buildHooks object is empty!');\n            }\n        })\n        .catch(e => reject(e));\n});\n\nconst rnvHooksPipes = c => new Promise((resolve, reject) => {\n    logTask('rnvHooksPipes');\n\n    buildHooks(c)\n        .then(() => {\n            const pipeOpts = generateOptions(c.buildPipes);\n            console.log(`Pipes:\\n${pipeOpts.asString}`);\n        }).catch(e => reject(e));\n});\n\nexport { buildHooks, rnvHooksList, rnvHooksRun, executePipe, rnvHooksPipes };\n"],"file":"buildHooks.js"}