{"version":3,"sources":["../../src/projectTools/package.js"],"names":["bumpVersions","version","Config","getConfig","paths","dir","project","pluginTemplates","rnv","packagesDir","path","join","fs","existsSync","packages","readdirSync","forEach","name","pkgPath","pkgJsonPath","lstatSync","isDirectory","existingPkgJson","require","renativePkgPath","config","renative","publishAll","Promise","all","map","cwd","rnvPkg","args","program","rawArgs","slice","firstArg","secondArg","semver","valid"],"mappings":"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","sourcesContent":["/* eslint-disable global-require, import/no-dynamic-require */\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nimport Config from '../config';\nimport { executeAsync } from '../systemTools/exec';\nimport { writeObjectSync, copyFileSync, updateObjectSync } from '../systemTools/fileutils';\nimport { logError } from '../systemTools/logger';\n\nconst bumpVersions = (version) => {\n    const { project: { dir }, rnv: { pluginTemplates } } = Config.getConfig().paths;\n    // check for packages to bump\n    const packagesDir = path.join(dir, 'packages');\n    if (fs.existsSync(packagesDir)) {\n        const packages = fs.readdirSync(packagesDir);\n        packages.forEach((name) => {\n            const pkgPath = path.join(packagesDir, name);\n            const pkgJsonPath = path.join(pkgPath, 'package.json');\n            if (fs.lstatSync(pkgPath).isDirectory() && fs.existsSync(pkgJsonPath)) {\n                // we found a packaaaage, fist-bumpin' it\n                const existingPkgJson = require(pkgJsonPath);\n                existingPkgJson.version = version;\n                writeObjectSync(pkgJsonPath, existingPkgJson);\n            }\n        });\n        // check if it's our turf and do some extra magic\n        const renativePkgPath = path.join(packagesDir, 'renative');\n        if (fs.existsSync(renativePkgPath)) {\n            copyFileSync(path.join(dir, 'README.md'), path.join(renativePkgPath, 'README.md'));\n            updateObjectSync(pluginTemplates.config, {\n                pluginTemplates: {\n                    renative: {\n                        version\n                    }\n                }\n            });\n        }\n    }\n};\n\nconst publishAll = () => {\n    const { project: { dir } } = Config.getConfig().paths;\n    const packagesDir = path.join(dir, 'packages');\n    if (fs.existsSync(packagesDir)) {\n        const packages = fs.readdirSync(packagesDir);\n        return Promise.all(packages.map((name) => {\n            const pkgPath = path.join(packagesDir, name);\n            return executeAsync('npm i', { cwd: pkgPath });\n        }));\n    }\n    return true;\n};\n\nconst rnvPkg = async () => {\n    let args = [...Config.getConfig().program.rawArgs];\n    args = args.slice(3);\n\n    const firstArg = args[0];\n    const secondArg = args[1];\n\n    switch (firstArg) {\n        case 'version':\n            // sets the given version to all of the packages, if there are any\n            if (!secondArg) return logError('No version specified', false, true);\n            if (!semver.valid(secondArg)) return logError(`Invalid version specified ${secondArg}`, false, true);\n            return bumpVersions(secondArg);\n        case 'publish':\n            return publishAll();\n        default:\n            logError(`Unknown argument ${firstArg}`, false, true);\n            break;\n    }\n};\n\nexport default rnvPkg;\n"],"file":"package.js"}