{"version":3,"sources":["../../../src/platformTools/firefox/index.js"],"names":["launchKaiOSSimulator","c","name","Promise","resolve","reject","files","workspace","config","sdks","KAIOS_SDK","paths","chalk","white","bold","ePath","path","join","fs","existsSync","childProcess","require","exec","err","stdout","stderr","configureKaiOSProject","platform","configureProject","appFolder","templateFolder","bundleIsDev","bundleAssets","manifestFilePath","manifestFilePath2","manifestFile","JSON","parse","readFileSync","description","developer","writeFileSync","stringify","runFirefoxProject","then","catch","e","buildFirefoxProject"],"mappings":"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","sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport chalk from 'chalk';\nimport {\n    getAppFolder,\n    getAppTitle,\n    getAppTemplateFolder,\n    getAppDescription,\n    getAppAuthor,\n    getConfigProp,\n} from '../../common';\nimport {\n    logTask\n} from '../../systemTools/logger';\nimport { isPlatformActive } from '..';\nimport { copyBuildsFolder, copyAssetsFolder } from '../../projectTools/projectParser';\nimport {\n    KAIOS_SDK,\n} from '../../constants';\nimport { getRealPath } from '../../systemTools/fileutils';\nimport { buildWeb, configureCoreWebProject } from '../web';\n\nconst launchKaiOSSimulator = (c, name) => new Promise((resolve, reject) => {\n    logTask('launchKaiOSSimulator');\n\n    if (!c.files.workspace.config.sdks.KAIOS_SDK) {\n        reject(\n            `${KAIOS_SDK} is not configured in your ${c.paths.workspace.config} file. Make sure you add location to your Kaiosrt App path similar to: ${chalk.white.bold(\n                '\"KAIOS_SDK\": \"/Applications/Kaiosrt.app\"'\n            )}`\n        );\n        return;\n    }\n\n    const ePath = getRealPath(path.join(c.files.workspace.config.sdks.KAIOS_SDK));\n\n    if (!fs.existsSync(ePath)) {\n        reject(`Can't find emulator at path: ${ePath}`);\n        return;\n    }\n\n    const childProcess = require('child_process');\n    childProcess.exec(`open ${ePath}`, (err, stdout, stderr) => {\n        if (err) {\n            reject(err);\n            return;\n        }\n        resolve();\n    });\n});\n\nconst configureKaiOSProject = async (c, platform) => {\n    logTask('configureKaiOSProject');\n\n    if (!isPlatformActive(c, platform)) return;\n\n    await copyAssetsFolder(c, platform);\n    await configureCoreWebProject(c, platform);\n    await configureProject(c, platform);\n    return copyBuildsFolder(c, platform);\n};\n\nconst configureProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`configureProject:${platform}`);\n\n    if (!isPlatformActive(c, platform, resolve)) return;\n\n    const appFolder = getAppFolder(c, platform);\n    const templateFolder = getAppTemplateFolder(c, platform);\n    const bundleIsDev = getConfigProp(c, platform, 'bundleIsDev') === true;\n    const bundleAssets = getConfigProp(c, platform, 'bundleAssets') === true;\n\n    const manifestFilePath = path.join(templateFolder, 'manifest.webapp');\n    const manifestFilePath2 = path.join(appFolder, 'manifest.webapp');\n    const manifestFile = JSON.parse(fs.readFileSync(manifestFilePath));\n\n    manifestFile.name = `${getAppTitle(c, platform)}`;\n    manifestFile.description = `${getAppDescription(c, platform)}`;\n    manifestFile.developer = getAppAuthor(c, platform);\n\n    fs.writeFileSync(manifestFilePath2, JSON.stringify(manifestFile, null, 2));\n\n    resolve();\n});\n\nconst runFirefoxProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`runFirefoxProject:${platform}`);\n\n    buildWeb(c, platform)\n        .then(() => launchKaiOSSimulator(c, platform))\n        .then(() => resolve())\n        .catch(e => reject(e));\n});\n\nconst buildFirefoxProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`buildFirefoxProject:${platform}`);\n\n    buildWeb(c, platform)\n        .then(() => resolve())\n        .catch(e => reject(e));\n});\n\nexport { launchKaiOSSimulator, configureKaiOSProject, runFirefoxProject, buildFirefoxProject };\n"],"file":"index.js"}