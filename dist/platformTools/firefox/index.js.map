{"version":3,"file":"index.js","names":["launchKaiOSSimulator","c","name","Promise","resolve","reject","logTask","files","workspace","config","sdks","KAIOS_SDK","paths","chalk","white","bold","ePath","getRealPath","path","join","fs","existsSync","childProcess","require","exec","err","stdout","stderr","configureKaiOSProject","platform","isPlatformActive","copyAssetsFolder","configureCoreWebProject","configureProject","copyBuildsFolder","appFolder","getAppFolder","templateFolder","getAppTemplateFolder","bundleIsDev","getConfigProp","bundleAssets","manifestFilePath","manifestFilePath2","manifestFile","JSON","parse","readFileSync","getAppTitle","description","getAppDescription","developer","getAppAuthor","writeFileSync","stringify","runFirefoxProject","buildWeb","then","catch","e","buildFirefoxProject"],"sources":["../../../src/platformTools/firefox/index.js"],"sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport chalk from 'chalk';\nimport {\n    getAppFolder,\n    getAppTitle,\n    getAppTemplateFolder,\n    getAppDescription,\n    getAppAuthor,\n    getConfigProp,\n} from '../../common';\nimport {\n    logTask\n} from '../../systemTools/logger';\nimport { isPlatformActive } from '..';\nimport { copyBuildsFolder, copyAssetsFolder } from '../../projectTools/projectParser';\nimport {\n    KAIOS_SDK,\n} from '../../constants';\nimport { getRealPath } from '../../systemTools/fileutils';\nimport { buildWeb, configureCoreWebProject } from '../web';\n\nconst launchKaiOSSimulator = (c, name) => new Promise((resolve, reject) => {\n    logTask('launchKaiOSSimulator');\n\n    if (!c.files.workspace.config.sdks.KAIOS_SDK) {\n        reject(\n            `${KAIOS_SDK} is not configured in your ${c.paths.workspace.config} file. Make sure you add location to your Kaiosrt App path similar to: ${chalk.white.bold(\n                '\"KAIOS_SDK\": \"/Applications/Kaiosrt.app\"'\n            )}`\n        );\n        return;\n    }\n\n    const ePath = getRealPath(path.join(c.files.workspace.config.sdks.KAIOS_SDK));\n\n    if (!fs.existsSync(ePath)) {\n        reject(`Can't find emulator at path: ${ePath}`);\n        return;\n    }\n\n    const childProcess = require('child_process');\n    childProcess.exec(`open ${ePath}`, (err, stdout, stderr) => {\n        if (err) {\n            reject(err);\n            return;\n        }\n        resolve();\n    });\n});\n\nconst configureKaiOSProject = async (c, platform) => {\n    logTask('configureKaiOSProject');\n\n    if (!isPlatformActive(c, platform)) return;\n\n    await copyAssetsFolder(c, platform);\n    await configureCoreWebProject(c, platform);\n    await configureProject(c, platform);\n    return copyBuildsFolder(c, platform);\n};\n\nconst configureProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`configureProject:${platform}`);\n\n    if (!isPlatformActive(c, platform, resolve)) return;\n\n    const appFolder = getAppFolder(c, platform);\n    const templateFolder = getAppTemplateFolder(c, platform);\n    const bundleIsDev = getConfigProp(c, platform, 'bundleIsDev') === true;\n    const bundleAssets = getConfigProp(c, platform, 'bundleAssets') === true;\n\n    const manifestFilePath = path.join(templateFolder, 'manifest.webapp');\n    const manifestFilePath2 = path.join(appFolder, 'manifest.webapp');\n    const manifestFile = JSON.parse(fs.readFileSync(manifestFilePath));\n\n    manifestFile.name = `${getAppTitle(c, platform)}`;\n    manifestFile.description = `${getAppDescription(c, platform)}`;\n    manifestFile.developer = getAppAuthor(c, platform);\n\n    fs.writeFileSync(manifestFilePath2, JSON.stringify(manifestFile, null, 2));\n\n    resolve();\n});\n\nconst runFirefoxProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`runFirefoxProject:${platform}`);\n\n    buildWeb(c, platform)\n        .then(() => launchKaiOSSimulator(c, platform))\n        .then(() => resolve())\n        .catch(e => reject(e));\n});\n\nconst buildFirefoxProject = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`buildFirefoxProject:${platform}`);\n\n    buildWeb(c, platform)\n        .then(() => resolve())\n        .catch(e => reject(e));\n});\n\nexport { launchKaiOSSimulator, configureKaiOSProject, runFirefoxProject, buildFirefoxProject };\n"],"mappings":"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"}