{"version":3,"file":"deviceManager.js","names":["CHECK_INTEVAL","currentDeviceProps","composeDevicesString","devices","returnArray","logTask","length","devicesArray","forEach","v","i","push","_getDeviceString","join","launchAndroidSimulator","c","platform","target","isIndependentThread","actualTarget","name","execCLI","CLI_ANDROID_EMULATOR","detached","catch","err","includes","logWarning","logError","Promise","resolve","reject","listAndroidTargets","device","program","resetAdb","getAndroidTargets","list","logToSummary","trim","isTV","isTablet","udid","isDevice","isActive","avdConfig","isWear","arch","deviceIcon","deviceString","chalk","white","grey","red","magenta","key","value","icon","ranBefore","CLI_ANDROID_ADB","setTimeout","skipDevices","skipAvds","deviceOnly","devicesResult","avdResult","_parseDevicesResult","calculateDeviceDiagonal","width","height","density","widthInches","heightInches","Math","sqrt","getRunningDeviceProp","prop","rawProps","reg","lines","match","line","words","split","slice","decideIfTVRunning","model","product","mod","flavor","clientIdBase","description","hdmi","modelGroup","configuration","cecEnabled","string","toLowerCase","decideIfWearRunning","fingerprint","getDeviceType","logDebug","isNotEligibleAndroid","screenSizeResult","screenDensityResult","screenProps","parseInt","diagonalInches","IS_TABLET_ABOVE_INCH","isPhone","isMobile","sysdir","tagId","tagDisplay","deviceName","avdId","AvdId","skin","image","getAvdDetails","process","env","ANDROID_SDK_HOME","ANDROID_AVD_HOME","avdConfigPaths","os","homedir","results","cPath","fs","existsSync","filesPath","readdirSync","fName","fPath","path","dirent","lstatSync","isDirectory","avdData","readFileSync","toString","initData","initLines","initLine","iniKey","iniValue","getEmulatorName","emulator","port","executeTelnet","emulatorReply","emulatorReplyArray","emulatorName","connectToWifiDevice","ip","deviceResponse","devicesString","avdsString","skipTargetCheck","all","map","filter","w","_getDeviceProp","waitForEmulatorToBeReady","avdLines","avdDetails","e","findProcess","isSystemWin","child_process","execSync","then","matches","ANDROID","ANDROID_WEAR","ANDROID_TV","arr","replace","askForNewEmulator","emuName","files","workspace","config","defaultTargets","inquirer","prompt","type","message","confirm","_createEmulator","apiVersion","emuPlatform","CLI_ANDROID_SDKMANAGER","CLI_ANDROID_AVDMANAGER","waitForEmulator","res","checkForActiveEmulator","attempts","maxAttempts","running","poll","setInterval","logSuccess","clearInterval","console","log"],"sources":["../../../src/platformTools/android/deviceManager.js"],"sourcesContent":["/* eslint-disable import/no-cycle */\n// @todo fix circular\nimport path from 'path';\nimport os from 'os';\nimport fs from 'fs';\nimport chalk from 'chalk';\nimport child_process from 'child_process';\nimport inquirer from 'inquirer';\n\nimport { execCLI, executeTelnet } from '../../systemTools/exec';\nimport { waitForEmulator } from '../../common';\nimport { isSystemWin } from '../../utils';\nimport { logToSummary, logTask,\n    logError, logWarning,\n    logDebug, logSuccess } from '../../systemTools/logger';\nimport { IS_TABLET_ABOVE_INCH, ANDROID_WEAR, ANDROID, ANDROID_TV, CLI_ANDROID_EMULATOR, CLI_ANDROID_ADB, CLI_ANDROID_AVDMANAGER, CLI_ANDROID_SDKMANAGER } from '../../constants';\n\nconst CHECK_INTEVAL = 5000;\n\nconst currentDeviceProps = {};\n\nexport const composeDevicesString = (devices, returnArray) => {\n    logTask(`composeDevicesString:${devices ? devices.length : null}`);\n    const devicesArray = [];\n    devices.forEach((v, i) => devicesArray.push(_getDeviceString(v, !returnArray ? i : null)));\n    if (returnArray) return devicesArray;\n    return `\\n${devicesArray.join('')}`;\n};\n\nexport const launchAndroidSimulator = (c, platform, target, isIndependentThread = false) => {\n    logTask(`launchAndroidSimulator:${platform}:${target}:${isIndependentThread}`);\n\n    if (target) {\n        const actualTarget = target.name || target;\n        if (isIndependentThread) {\n            execCLI(c, CLI_ANDROID_EMULATOR, `-avd \"${actualTarget}\"`, { detached: isIndependentThread }).catch((err) => {\n                if (err.includes && err.includes('WHPX')) {\n                    logWarning(err);\n                    return logError('It seems you do not have the Windows Hypervisor Platform virtualization enabled. Enter windows features in the Windows search box and select Turn Windows features on or off in the search results. In the Windows Features dialog, enable both Hyper-V and Windows Hypervisor Platform.', true);\n                }\n                logError(err);\n            });\n            return Promise.resolve();\n        }\n        return execCLI(c, CLI_ANDROID_EMULATOR, `-avd \"${actualTarget}\"`, { detached: isIndependentThread });\n    }\n    return Promise.reject('No simulator -t target name specified!');\n};\n\nexport const listAndroidTargets = async (c) => {\n    logTask('listAndroidTargets');\n    const { program: { device } } = c;\n\n    await resetAdb(c);\n    const list = await getAndroidTargets(c, false, device, device);\n    const devices = await composeDevicesString(list);\n    logToSummary(`Android Targets:\\n${devices}`);\n    if (devices.trim() === '') logToSummary('Android Targets: No devices found');\n    return devices;\n};\n\nconst _getDeviceString = (device, i) => {\n    const {\n        isTV, isTablet, name, udid, isDevice, isActive, avdConfig, isWear, arch\n    } = device;\n    let deviceIcon = '';\n    if (isTablet) deviceIcon = 'Tablet ðŸ’Š ';\n    if (isTV) deviceIcon = 'TV ðŸ“º ';\n    if (isWear) deviceIcon = 'Wear âŒš ';\n    if (!deviceIcon && (udid !== 'unknown' || avdConfig)) deviceIcon = 'Phone ðŸ“± ';\n\n    const deviceString = `${chalk.white(name)} | ${deviceIcon} | arch: ${arch} | udid: ${chalk.grey(udid)}${isDevice ? chalk.red(' (device)') : ''} ${\n        isActive ? chalk.magenta(' (active)') : ''}`;\n\n    if (i === null) return { key: name, name: deviceString, value: name, icon: deviceIcon };\n\n    return ` [${i + 1}]> ${deviceString}\\n`;\n};\n\nexport const resetAdb = async (c, ranBefore) => {\n    try {\n        if (!ranBefore) await execCLI(c, CLI_ANDROID_ADB, 'kill-server');\n    } catch (e) {\n        logWarning(e);\n    }\n    try {\n        await execCLI(c, CLI_ANDROID_ADB, 'start-server');\n    } catch (e) {\n        if (ranBefore) {\n            return Promise.reject(e);\n        }\n        logWarning(`Got error:\\n${e}\\nWill attemnt again in 5 seconds`);\n        setTimeout(resetAdb, 5000, c, true);\n    }\n};\n\nexport const getAndroidTargets = async (c, skipDevices, skipAvds, deviceOnly = false) => {\n    logTask(`getAndroidTargets:${c.platform}:${skipDevices}:${skipAvds}:${deviceOnly}`);\n\n    try {\n        let devicesResult;\n        let avdResult;\n\n        if (!skipDevices) {\n            devicesResult = await execCLI(c, CLI_ANDROID_ADB, 'devices -l');\n        }\n        if (!skipAvds) {\n            avdResult = await execCLI(c, CLI_ANDROID_EMULATOR, '-list-avds');\n        }\n        return _parseDevicesResult(c, devicesResult, avdResult, deviceOnly);\n    } catch (e) {\n        return Promise.reject(e);\n    }\n};\n\nconst calculateDeviceDiagonal = (width, height, density) => {\n    // Calculate the diagonal in inches\n    const widthInches = width / density;\n    const heightInches = height / density;\n    return Math.sqrt(widthInches * widthInches + heightInches * heightInches);\n};\n\nconst getRunningDeviceProp = async (c, udid, prop) => {\n    // avoid multiple calls to the same device\n    if (currentDeviceProps[udid]) {\n        if (!prop) return currentDeviceProps[udid];\n        return currentDeviceProps[udid][prop];\n    }\n    const rawProps = await execCLI(c, CLI_ANDROID_ADB, `-s ${udid} shell getprop`);\n    const reg = /\\[.+\\]: \\[.*\\n?[^\\[]*\\]/gm;\n    const lines = rawProps.match(reg);\n\n    lines.forEach((line) => {\n        const words = line.split(']: [');\n        const key = words[0].slice(1);\n        const value = words[1].slice(0, words[1].length - 1);\n\n        if (!currentDeviceProps[udid]) currentDeviceProps[udid] = {};\n        currentDeviceProps[udid][key] = value;\n    });\n\n    return getRunningDeviceProp(c, udid, prop);\n};\n\nconst decideIfTVRunning = async (c, device) => {\n    const { udid, model, product } = device;\n    const mod = await getRunningDeviceProp(c, udid, 'ro.product.model');\n    const name = await getRunningDeviceProp(c, udid, 'ro.product.name');\n    const flavor = await getRunningDeviceProp(c, udid, 'ro.build.flavor');\n    const clientIdBase = await getRunningDeviceProp(c, udid, 'ro.com.google.clientidbase');\n    const description = await getRunningDeviceProp(c, udid, 'ro.build.description');\n    const hdmi = await getRunningDeviceProp(c, udid, 'init.svc.hdmi');\n    const modelGroup = await getRunningDeviceProp(c, udid, 'ro.nrdp.modelgroup');\n    const configuration = await getRunningDeviceProp(c, udid, 'ro.build.configuration');\n    const cecEnabled = await getRunningDeviceProp(c, udid, 'persist.sys.cec.enabled');\n\n    let isTV = false;\n    [mod, name, flavor, clientIdBase, description, model, product].forEach((string) => {\n        if (string && string.toLowerCase().includes('tv')) isTV = true;\n    });\n\n    if (model.includes('SHIELD')) isTV = true;\n    if (hdmi) isTV = true;\n    if (modelGroup && modelGroup.toLowerCase().includes('firetv')) isTV = true;\n    if (configuration === 'tv') isTV = true;\n    if (cecEnabled) isTV = true;\n\n    return isTV;\n};\n\nconst decideIfWearRunning = async (c, device) => {\n    const { udid, model, product } = device;\n    const fingerprint = await getRunningDeviceProp(c, udid, 'ro.vendor.build.fingerprint');\n    const name = await getRunningDeviceProp(c, udid, 'ro.product.vendor.name');\n    const mod = await getRunningDeviceProp(c, udid, 'ro.product.vendor.model');\n    const flavor = await getRunningDeviceProp(c, udid, 'ro.build.flavor');\n    const description = await getRunningDeviceProp(c, udid, 'ro.build.description');\n\n    let isWear = false;\n    [fingerprint, name, mod, flavor, description, model, product].forEach((string) => {\n        if (string && string.toLowerCase().includes('wear')) isWear = true;\n    });\n    return isWear;\n};\n\nconst getDeviceType = async (device, c) => {\n    logDebug('getDeviceType - in', { device });\n\n    if (device.product === 'tunny') {\n        device.isNotEligibleAndroid = true;\n        return device;\n    }\n\n    if (device.udid !== 'unknown') {\n        const screenSizeResult = await execCLI(c, CLI_ANDROID_ADB, `-s ${device.udid} shell wm size`);\n        const screenDensityResult = await execCLI(c, CLI_ANDROID_ADB, `-s ${device.udid} shell wm density`);\n        const arch = await getRunningDeviceProp(c, device.udid, 'ro.product.cpu.abi');\n        let screenProps;\n\n        if (screenSizeResult) {\n            const [width, height] = screenSizeResult.split('Physical size: ')[1].split('x');\n            screenProps = { width: parseInt(width, 10), height: parseInt(height, 10) };\n        }\n\n        if (screenDensityResult) {\n            const density = screenDensityResult.split('Physical density: ')[1];\n            screenProps = { ...screenProps, density: parseInt(density, 10) };\n        }\n\n        device.isTV = await decideIfTVRunning(c, device);\n\n        if (screenSizeResult && screenDensityResult) {\n            const { width, height, density } = screenProps;\n\n            const diagonalInches = calculateDeviceDiagonal(width, height, density);\n            screenProps = { ...screenProps, diagonalInches };\n            device.isTablet = !device.isTV && diagonalInches > IS_TABLET_ABOVE_INCH && diagonalInches <= 15;\n            device.isWear = await decideIfWearRunning(c, device);\n        }\n\n        device.isPhone = !device.isTablet && !device.isWear && !device.isTV;\n        device.isMobile = !device.isWear && !device.isTV;\n        device.screenProps = screenProps;\n        device.arch = arch;\n        logDebug('getDeviceType - out', { device });\n        return device;\n    }\n\n    if (device.avdConfig) {\n        const density = parseInt(device.avdConfig['hw.lcd.density'], 10);\n        const width = parseInt(device.avdConfig['hw.lcd.width'], 10);\n        const height = parseInt(device.avdConfig['hw.lcd.height'], 10);\n        const arch = device.avdConfig['abi.type'];\n\n        // Better detect wear\n        const sysdir = device.avdConfig['image.sysdir.1'];\n        const tagId = device.avdConfig['tag.id'];\n        const tagDisplay = device.avdConfig['tag.display'];\n        const deviceName = device.avdConfig['hw.device.name'];\n\n        device.isWear = false;\n        [sysdir, tagId, tagDisplay, deviceName].forEach((string) => {\n            if (string && string.includes('wear')) device.isWear = true;\n        });\n\n        const avdId = device.avdConfig.AvdId;\n        const name = device.avdConfig['hw.device.name'];\n        const skin = device.avdConfig['skin.name'];\n        const image = device.avdConfig['image.sysdir.1'];\n\n        device.isTV = false;\n        [avdId, name, skin, image].forEach((string) => {\n            if (string && string.toLowerCase().includes('tv')) device.isTV = true;\n        });\n\n        const diagonalInches = calculateDeviceDiagonal(width, height, density);\n        device.isTablet = !device.isTV && diagonalInches > IS_TABLET_ABOVE_INCH;\n        device.isPhone = !device.isTablet && !device.isWear && !device.isTV;\n        device.isMobile = !device.isWear && !device.isTV;\n        device.arch = arch;\n        logDebug('getDeviceType - out', { device });\n        return device;\n    }\n    return device;\n};\n\nconst getAvdDetails = (c, deviceName) => {\n    const { ANDROID_SDK_HOME, ANDROID_AVD_HOME } = process.env;\n\n    // .avd dir might be in other place than homedir. (https://developer.android.com/studio/command-line/variables)\n    const avdConfigPaths = [\n        `${ANDROID_AVD_HOME}`,\n        `${ANDROID_SDK_HOME}/.android/avd`,\n        `${os.homedir()}/.android/avd`,\n    ];\n\n    const results = {};\n\n    avdConfigPaths.forEach((cPath) => {\n        if (fs.existsSync(cPath)) {\n            const filesPath = fs.readdirSync(cPath);\n\n\n            filesPath.forEach((fName) => {\n                const fPath = path.join(cPath, fName);\n                const dirent = fs.lstatSync(fPath);\n                if (!dirent.isDirectory() && fName === `${deviceName}.ini`) {\n                    const avdData = fs.readFileSync(fPath).toString();\n                    const lines = avdData.trim().split(/\\r?\\n/);\n                    lines.forEach((line) => {\n                        const [key, value] = line.split('=');\n                        if (key === 'path') {\n                            const initData = fs.readFileSync(`${value}/config.ini`).toString();\n                            const initLines = initData.trim().split(/\\r?\\n/);\n                            const avdConfig = {};\n                            initLines.forEach((initLine) => {\n                                const [iniKey, iniValue] = initLine.split('=');\n                                // also remove the white space\n                                avdConfig[iniKey.trim()] = iniValue.trim();\n                            });\n                            results.avdConfig = avdConfig;\n                        }\n                    });\n                }\n            });\n        }\n    });\n    return results;\n};\n\nconst getEmulatorName = async (c, words) => {\n    const emulator = words[0];\n    const port = emulator.split('-')[1];\n\n    const emulatorReply = await executeTelnet(c, port, 'avd name');\n    const emulatorReplyArray = emulatorReply.split('OK');\n    const emulatorName = emulatorReplyArray[emulatorReplyArray.length - 2].trim();\n    return emulatorName;\n};\n\nexport const connectToWifiDevice = async (c, ip) => {\n    const deviceResponse = await execCLI(c, CLI_ANDROID_ADB, `connect ${ip}:5555`);\n    if (deviceResponse.includes('connected')) return true;\n    logError(`Failed to connect to ${ip}:5555`, false, true);\n    return false;\n};\n\nconst _parseDevicesResult = async (c, devicesString, avdsString, deviceOnly) => {\n    logDebug(`_parseDevicesResult:${devicesString}:${avdsString}:${deviceOnly}`);\n    const devices = [];\n    const { skipTargetCheck } = c.program;\n\n    if (devicesString) {\n        const lines = devicesString.trim().split(/\\r?\\n/);\n        logDebug('_parseDevicesResult 2', { lines });\n        if (lines.length !== 0) {\n            await Promise.all(lines.map(async (line) => {\n                const words = line.split(/[ ,\\t]+/).filter(w => w !== '');\n                if (words.length === 0) return;\n                logDebug('_parseDevicesResult 3', { words });\n\n                if (words[1] === 'device') {\n                    const isDevice = !words[0].includes('emulator');\n                    let name = _getDeviceProp(words, 'model:');\n                    const model = name;\n                    const product = _getDeviceProp(words, 'product:');\n                    logDebug('_parseDevicesResult 4', { name });\n                    if (!isDevice) {\n                        await waitForEmulatorToBeReady(c, words[0]);\n                        name = await getEmulatorName(c, words);\n                        logDebug('_parseDevicesResult 5', { name });\n                    }\n                    logDebug('_parseDevicesResult 6', { deviceOnly, isDevice });\n                    if ((deviceOnly && isDevice) || !deviceOnly) {\n                        devices.push({\n                            udid: words[0],\n                            isDevice,\n                            isActive: true,\n                            name,\n                            model,\n                            product\n                        });\n                    }\n                    return true;\n                }\n            }));\n        }\n    }\n\n    if (avdsString) {\n        const avdLines = avdsString.trim().split(/\\r?\\n/);\n        logDebug('_parseDevicesResult 7', { avdLines });\n\n        await Promise.all(avdLines.map(async (line) => {\n            let avdDetails;\n\n            try {\n                avdDetails = getAvdDetails(c, line);\n            } catch (e) {\n                logError(e);\n            }\n\n            try {\n                logDebug('_parseDevicesResult 8', { avdDetails });\n\n                // Yes, 2 greps. Hacky but it excludes the grep process corectly and quickly :)\n                // if this runs without throwing it means that the simulator is running so it needs to be excluded\n                const findProcess = isSystemWin ? `tasklist | find \"avd ${line}\"` : `ps x | grep \"avd ${line}\" | grep -v grep`;\n                child_process.execSync(findProcess);\n                logDebug('_parseDevicesResult 9 - excluding running emulator');\n            } catch (e) {\n                if (avdDetails) {\n                    devices.push({\n                        udid: 'unknown',\n                        isDevice: false,\n                        isActive: false,\n                        name: line,\n                        ...avdDetails\n                    });\n                }\n            }\n        }));\n    }\n\n    logDebug('_parseDevicesResult 10', { devices });\n\n    return Promise.all(devices.map(device => getDeviceType(device, c)))\n        .then(devicesArray => devicesArray.filter((device) => {\n            // filter devices based on selected platform\n            const { platform } = c;\n            if (skipTargetCheck) return true; // return everything if skipTargetCheck is used\n            if (device.isNotEligibleAndroid) return false;\n            const matches = (platform === ANDROID && device.isTablet) || (platform === ANDROID_WEAR && device.isWear) || (platform === ANDROID_TV && device.isTV) || (platform === ANDROID && device.isMobile);\n            logDebug('getDeviceType - filter', { device, matches, platform });\n            return matches;\n        }));\n};\n\nconst _getDeviceProp = (arr, prop) => {\n    for (let i = 0; i < arr.length; i++) {\n        const v = arr[i];\n        if (v && v.includes(prop)) return v.replace(prop, '');\n    }\n    return '';\n};\n\nexport const askForNewEmulator = async (c, platform) => {\n    logTask('askForNewEmulator');\n    const emuName = c.files.workspace.config.defaultTargets[platform];\n\n    const { confirm } = await inquirer.prompt({\n        name: 'confirm',\n        type: 'confirm',\n        message: `Do you want ReNative to create new Emulator (${chalk.white(emuName)}) for you?`\n    });\n\n    if (confirm) {\n        switch (platform) {\n            case 'android':\n                return _createEmulator(c, '28', 'google_apis', emuName)\n                    .then(() => launchAndroidSimulator(c, platform, emuName, true));\n            case 'androidtv':\n                return _createEmulator(c, '28', 'android-tv', emuName)\n                    .then(() => launchAndroidSimulator(c, platform, emuName, true));\n            case 'androidwear':\n                return _createEmulator(c, '28', 'android-wear', emuName)\n                    .then(() => launchAndroidSimulator(c, platform, emuName, true));\n            default:\n                return Promise.reject('Cannot find any active or created emulators');\n        }\n    }\n    return Promise.reject('Action canceled!');\n};\n\nconst _createEmulator = (c, apiVersion, emuPlatform, emuName) => {\n    logTask('_createEmulator');\n\n    return execCLI(c, CLI_ANDROID_SDKMANAGER, `\"system-images;android-${apiVersion};${emuPlatform};x86\"`)\n        .then(() => execCLI(c, CLI_ANDROID_AVDMANAGER, `create avd -n ${emuName} -k \"system-images;android-${apiVersion};${emuPlatform};x86\"`))\n        .catch(e => logError(e, true));\n};\n\nconst waitForEmulatorToBeReady = (c, emulator) => waitForEmulator(c, CLI_ANDROID_ADB, `-s ${emulator} shell getprop init.svc.bootanim`, res => res.includes('stopped'));\n\nexport const checkForActiveEmulator = (c, platform) => new Promise((resolve, reject) => {\n    logTask(`checkForActiveEmulator:${platform}`);\n    let attempts = 1;\n    const maxAttempts = isSystemWin ? 20 : 10;\n    let running = false;\n    const poll = setInterval(() => {\n        // Prevent the interval from running until enough promises return to make it stop or we get a result\n        if (!running) {\n            running = true;\n            getAndroidTargets(c, false, true, false)\n                .then(async (v) => {\n                    logDebug('Available devices after filtering', v);\n                    if (v.length > 0) {\n                        logSuccess(`Found active emulator! ${chalk.white(v[0].udid)}. Will use it`);\n                        clearInterval(poll);\n                        resolve(v[0]);\n                    } else {\n                        console.log(`looking for active emulators: attempt ${attempts}/${maxAttempts}`);\n                        attempts++;\n                        if ([ANDROID_TV, ANDROID_WEAR].includes(platform) && attempts === 2) {\n                            await resetAdb(c); // from time to time adb reports a recently started atv emu as being offline. Restarting adb fixes it\n                        }\n                        if (attempts > maxAttempts) {\n                            clearInterval(poll);\n                            reject('Could not find any active emulatros');\n                            // TODO: Asking for new emulator is worng as it diverts\n                            // user from underlying failure of not being able to connect\n                            // return _askForNewEmulator(c, platform);\n                        }\n                        running = false;\n                    }\n                })\n                .catch((e) => {\n                    clearInterval(poll);\n                    logError(e);\n                });\n        }\n    }, CHECK_INTEVAL);\n});\n"],"mappings":"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"}